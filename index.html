<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' 'unsafe-eval'; img-src 'self' data: https://*; object-src 'none'; frame-ancestors 'none';">
    <title>KidsGPT.eu - Dein KI-Helfer f√ºr Lernen, Spa√ü & Alltag - Kostenlose Prompts f√ºr Schule, Hausaufgaben und mehr</title>
    <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="KidsGPT.eu" />
    <link rel="manifest" href="site.webmanifest" />
    <link rel="canonical" href="https://www.kidsgpt.eu/" />
    <style>
        @font-face {
            font-family: 'Montserrat';
            src: local('Montserrat Italic'), local('Montserrat-Italic'),
                url('subset-Montserrat-Italic.woff2') format('woff2'),
                url('subset-Montserrat-Italic.woff') format('woff');
            font-weight: normal;
            font-style: italic;
            font-display: swap;
        }

        @font-face {
            font-family: 'Montserrat';
            src: local('Montserrat Regular'), local('Montserrat-Regular'),
                url('subset-Montserrat-Regular.woff2') format('woff2'),
                url('subset-Montserrat-Regular.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'Montserrat';
            src: local('Montserrat Bold'), local('Montserrat-Bold'),
                url('subset-Montserrat-Bold.woff2') format('woff2'),
                url('subset-Montserrat-Bold.woff') format('woff');
            font-weight: bold;
            font-style: normal;
            font-display: swap;
        }

        :root {
          /* Farben hier anpassen f√ºr besseren Kontrast! */
          --primary-color: #00bfa6; /* T√ºrkis */
          --primary-color-dark: #0284c7; /* Dunkleres Blau (Original) */
          /* NEU: Dunkleres Blau f√ºr besseren Kontrast */
          --primary-color-darker: #01579b;
          --secondary-color: #ffb84d; /* Orange */
          --accent-color: #7c4502;  /* Dunkles Orange */
          --success-color: #22c55e; /* Gr√ºn */
          --info-color: #007bff; /* Blau f√ºr Info/Feedback */
          --error-color: #ff4d4f; /* Rot */
          --focus-outline-color: #007bff; /* Standard Blau f√ºr Fokus */
          --background-body: #fff9f0;
          --background-section: #ffffff;
          --background-selected: #e0f7fa; /* Helleres T√ºrkis/Cyan */
          --background-prompt-item: #f8f9fa;
          --background-category-active: var(--primary-color); /* Wird nicht mehr f√ºr Buttons gebraucht */
          --background-accordion-active: #f5fdff; /* Leicht bl√§ulicher Hintergrund f√ºr aktives Akkordeon */
          --background-accordion-completed: #f8f9fa; /* Leicht grauer Hintergrund f√ºr abgeschlossenes Akkordeon */
          /* NEU: Hintergrund f√ºr Buch-Sektion */
          --background-book-section: #f0fdfa; /* Sehr helles T√ºrkis/Cyan */
          --text-dark: #333333;
          --text-light: #ffffff;
          --text-muted: #6b7280;
          /* Original-Linkfarbe beibehalten f√ºr generelle Links, problematische Links √ºberschreiben */
          --text-link: var(--primary-color-dark);
          --border-color: #d1d5db;
          --border-color-selected: var(--primary-color-dark); /* Dunkleres T√ºrkis/Blau f√ºr Auswahl */
          --border-color-accordion-active: var(--primary-color); /* Rahmen f√ºr aktives Akkordeon */
          /* NEU: Rahmenfarbe f√ºr Buch-Sektion */
          --border-color-book-section: #a7f3d0; /* Helleres T√ºrkis/Gr√ºn */
          --border-radius-small: 4px;
          --border-radius-medium: 8px;
          --border-radius-large: 12px;
          --shadow-light: 0 2px 4px rgba(0, 0, 0, 0.05);
          --shadow-medium: 0 4px 8px rgba(0, 0, 0, 0.1);
          --shadow-selected: 0 5px 15px rgba(0, 191, 166, 0.3); /* Etwas st√§rkerer Schatten f√ºr Auswahl */
          --shadow-hover: 0 8px 15px rgba(0, 0, 0, 0.15);
          --font-family-base: 'Montserrat', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          --font-size-base: 16px;
          --font-size-h1: 2rem;
          --font-size-h2: 1.5rem;
          --font-size-h3: 1.25rem;
          --font-size-h4: 1.2rem;
          --font-size-h5: 1.15rem;
          --font-size-h6: 1.1rem;
          --font-size-p: 1rem;
          --font-size-label: 0.9rem;
          --font-size-small: 0.85rem;
          --line-height-base: 1.6;
          --transition-speed: 0.3s;
          --transition-timing: ease-in-out;
          --container-width: 1000px;
        }

        /* --- BASIS-STILE --- */
        html { font-size: 100%; scroll-behavior: smooth; }
        body {
            font-family: var(--font-family-base); font-size: var(--font-size-base);
            line-height: var(--line-height-base);
            background: linear-gradient(180deg, var(--background-body) 0%, #fff9f0 100%);
            color: var(--text-dark); margin: 0; padding: 20px; font-synthesis: none;
            text-rendering: optimizeLegibility; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }
        .container { max-width: var(--container-width); margin: 0 auto; }
        a { color: var(--text-link); text-decoration: none; transition: color var(--transition-speed) ease; }
        a:hover { color: var(--primary-color-darker); text-decoration: underline; } /* Hover auf dunkleres Blau ge√§ndert */

        /* --- Accessibility: Verbesserter Fokus-Indikator --- */
        :focus-visible {
            outline: 3px solid var(--focus-outline-color);
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.25);
            border-radius: var(--border-radius-small);
        }
        :focus:not(:focus-visible) { outline: none; }


        /* --- HEADER --- */
        .header { padding: 10px 0px; margin-bottom: 15px; text-align: center; display: flex; flex-direction: column; align-items: center; }
        .logo { max-width: 150px; height: auto; margin-bottom: 15px; } /* Abstand hinzugef√ºgt */
        .header h1 { font-size: var(--font-size-h1); margin: 0; color: var(--text-dark); line-height: 1.2; } /* H1 Styling */

        /* --- SEKTIONEN & √úberschriften --- */
        .section { background-color: var(--background-section); border-radius: var(--border-radius-medium); padding: 0; margin-bottom: 25px; box-shadow: var(--shadow-light); overflow: hidden; }
        .section-header { padding: 20px 25px; border-bottom: 1px solid var(--border-color); }
        .section-header h2 { margin: 0; padding: 0; border-bottom: none; font-size: var(--font-size-h2); color: var(--primary-color-dark); line-height: 1.3;}
        .section-header p { margin: 0.5rem 0 0 0; font-size: 1rem; }
        .section-header .ki-hinweis-banner { background-color: #fff3cd; color: #856404; padding: 1rem; border: 1px solid #ffeeba; border-radius: var(--border-radius-medium); font-size: var(--font-size-p); margin-top: 1rem; margin-bottom: 0;}
        /* KONTRAST FIX: Link im Hinweisbanner */
        .section-header .ki-hinweis-banner a {
            color: var(--primary-color-darker); /* Dunkleres Blau f√ºr Kontrast auf Gelb */
            text-decoration: underline; /* Unterstreichen zur Verdeutlichung */
        }
        .section-header .ki-hinweis-banner a:hover {
            color: #014175; /* Noch etwas dunkler bei Hover */
        }
        /* KONTRAST FIX: Links im "√úber dieses Projekt" Text */
        .section-header p a {
             color: var(--primary-color-darker); /* Dunkleres Blau f√ºr Kontrast auf Wei√ü */
        }
        .section-header p a:hover {
            color: var(--primary-color-dark); /* Original dunkles Blau bei Hover */
        }

        /* H3/H4/H5 f√ºr Akkordeon-Inhalt (vorher H4/H5/H6) */
        .accordion-content h3 {
            font-size: var(--font-size-h3);
            /* KONTRAST FIX: Farbe f√ºr H3 im Akkordeon */
            color: var(--primary-color-darker);
            margin-top: 1.5rem; margin-bottom: 1rem; padding-bottom: 5px;
            border-bottom: 2px solid var(--primary-color);
        }
        .accordion-content h4 {
            font-size: var(--font-size-h5); color: var(--text-muted);
            margin-top: 1.2rem; margin-bottom: 0.8rem; font-weight: bold;
        }
         .accordion-content h5 {
            font-size: var(--font-size-h5); color: var(--text-muted);
            margin-top: 1rem; margin-bottom: 0.6rem; font-weight: bold;
        }
        .accordion-content > h3:first-of-type,
        .accordion-content > h4:first-of-type,
        .accordion-content > h5:first-of-type { margin-top: 0; }

        /* NEU: Visueller Trenner */
        .section-divider {
            border: none;
            border-top: 2px dashed var(--border-color);
            margin: 30px 0;
        }

        /* --- AKKORDEON STILE --- */
        .accordion-section {
            border-bottom: 1px solid var(--border-color);
            transition: background-color var(--transition-speed) var(--transition-timing);
        }
        .accordion-section:last-child { border-bottom: none; }

        .accordion-header {
            font-size: var(--font-size-h2);
            color: var(--primary-color-dark);
            margin: 0; padding: 18px 25px; line-height: 1.4;
            cursor: pointer; position: relative; user-select: none;
            transition: background-color var(--transition-speed) var(--transition-timing), color var(--transition-speed) var(--transition-timing);
            font-weight: bold;
        }
         .accordion-header::after {
            content: '‚ñº'; position: absolute; right: 25px; top: 50%;
            transform: translateY(-50%); font-size: 0.5em; color: var(--text-muted);
            transition: transform var(--transition-speed) var(--transition-timing);
         }
         .accordion-section.active-section > .accordion-header::after { transform: translateY(-50%) rotate(180deg); }
         .accordion-header:hover { background-color: #f8f9fa; }

         /* Status f√ºr Akkordeon */
         .accordion-section.active-section {
             background-color: var(--background-accordion-active);
             border-left: 4px solid var(--border-color-accordion-active);
         }
         .accordion-section.active-section > .accordion-header { color: var(--primary-color-dark); }
         .accordion-section.completed-section { background-color: var(--background-accordion-completed); }
         .accordion-section.completed-section > .accordion-header { color: var(--text-muted); font-weight: normal; }
         .accordion-section.completed-section > .accordion-header:hover { background-color: #e9ecef; color: var(--text-dark); }
         .accordion-section.next-section-highlight > .accordion-header { /* Optional */ }

        .accordion-content {
            max-height: 0; overflow: hidden; padding: 0 25px;
            transition: max-height var(--transition-speed) var(--transition-timing), padding var(--transition-speed) var(--transition-timing);
        }
        .accordion-content.open {
            padding: 20px 25px;
            transition: max-height 0.5s var(--transition-timing), padding 0.5s var(--transition-timing);
        }
        .accordion-content > *:first-child { margin-top: 0; }

        /* Zur√ºck-Button */
        .back-btn {
            display: inline-block; margin-bottom: 15px; padding: 6px 12px;
            font-size: 0.9rem; font-weight: bold; color: var(--text-muted); background-color: transparent;
            border: 1px solid var(--border-color); border-radius: var(--border-radius-small); cursor: pointer; transition: all var(--transition-speed) ease;
        }
        .back-btn:hover { background-color: #f8f9fa; color: var(--text-dark); border-color: #adb5bd; }

        /* --- Generische Prompt-Karten --- */
        .generic-prompts-container {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px; margin-bottom: 0;
        }
        .generic-prompt-card {
            display: flex; flex-direction: column; align-items: center; text-align: center;
            padding: 20px 15px; border: 2px solid var(--border-color);
            border-radius: var(--border-radius-medium); background-color: var(--background-section);
            cursor: pointer; transition: all var(--transition-speed) var(--transition-timing);
            position: relative; min-height: 200px;
        }
        .prompt-card-icon {
            line-height: 1; width: 100px; height: 100px; display: flex; align-items: center; justify-content: center;
        }
        .prompt-card-icon img.prompt-card-img { width: 125px; height: 125px; display: block; }
        /* √úberschrift hier jetzt h4 statt h5 */
        .prompt-card-title { font-size: var(--font-size-h5); font-weight: bold; color: var(--primary-color-dark); margin-bottom: 10px; line-height: 1.3; }
        .prompt-card-description { font-size: 0.9rem; color: var(--text-muted); line-height: 1.5; flex-grow: 1; margin-bottom: 0; }
        .generic-prompt-card:hover { border-color: var(--primary-color); background-color: #f7feff; transform: translateY(-3px); box-shadow: var(--shadow-medium); }
        .generic-prompt-card.selected { border-color: var(--border-color-selected); background-color: var(--background-selected); box-shadow: var(--shadow-selected); transform: translateY(0); }
        .generic-prompt-card.selected::after { content: '‚úî'; position: absolute; top: 8px; right: 10px; font-size: 1.4rem; color: var(--primary-color-dark); font-weight: bold; line-height: 1; }


        /* --- FORMULAR ELEMENTE & FILTER --- */
        .form-group { margin-bottom: 15px; display: flex; flex-direction: column; }
        .form-group label { font-weight: bold; margin-bottom: 5px; font-size: var(--font-size-label); color: var(--text-muted); }
        .form-group input[type="search"], .form-group select, .form-group textarea { /* Textarea hinzugef√ºgt */
            width: 100%; padding: 10px 12px; border: 1px solid var(--border-color);
            border-radius: var(--border-radius-small); font-size: var(--font-size-p); box-sizing: border-box;
            transition: border-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease; background-color: #fff;
        }
        .form-group select {
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%236b7280%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat; background-position: right 12px center; background-size: 10px 10px; padding-right: 35px;
        }
        .form-group input[type="search"]:focus, .form-group select:focus, .form-group textarea:focus { /* Textarea hinzugef√ºgt */
             border-color: var(--primary-color-dark); box-shadow: 0 0 0 3px rgba(0, 191, 166, 0.15);
        }
        .form-group select::-ms-expand { display: none; }

        .filter-group-combined { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; align-items: flex-end; }
        .filter-group-combined .form-group { flex: 1; min-width: 180px; margin-bottom: 0; }

        .error-message {
            color: var(--error-color); font-size: var(--font-size-small); margin-top: 8px;
            display: none; text-align: left; width: 100%; font-weight: bold;
            padding: 5px 0; transition: opacity 0.3s ease; opacity: 0;
        }
        .error-message.visible { display: block; opacity: 1; animation: errorPulse 0.5s ease-out; }
        @keyframes errorPulse { 0% { } 50% { background-color: rgba(255, 77, 79, 0.05); } 100% { } }

        /* NEU: Feedback-Nachrichten-Styling */
        .feedback-message {
             color: var(--info-color); /* Blau f√ºr Feedback */
             font-size: var(--font-size-small);
             margin-top: 8px;
             display: none; /* Wird durch JS gesteuert */
             text-align: left;
             width: 100%;
             font-weight: bold;
             padding: 5px 0;
             transition: opacity 0.3s ease;
             opacity: 0;
        }
        .feedback-message.visible { display: block; opacity: 1; }


        /* --- PROMPT-BIBLIOTHEK LISTE --- */
        #prompt-library-list {
            max-height: 400px; overflow-y: auto; border: 1px solid var(--border-color);
            border-radius: var(--border-radius-medium); padding: 5px; margin-bottom: 10px; background-color: #fdfdfe;
        }
        #prompt-library-list .empty-list-message { padding: 25px; text-align: center; color: var(--text-muted); font-style: italic; }
        .prompt-item {
            background-color: var(--background-prompt-item); border: 1px solid var(--border-color);
            border-radius: var(--border-radius-small); padding: 12px 15px; margin: 8px; cursor: pointer;
            transition: all var(--transition-speed) var(--transition-timing); position: relative; border-left: 4px solid var(--border-color);
        }
        .prompt-item:hover {
             border-color: var(--primary-color); background-color: #fff; transform: translateX(3px); box-shadow: var(--shadow-light); border-left-color: var(--secondary-color);
        }
        .prompt-item.selected-prompt {
             border: 1px solid var(--border-color-selected); border-left: 4px solid var(--primary-color-dark); background-color: var(--background-selected); box-shadow: var(--shadow-selected); transform: translateX(0);
        }
        /* NEU: Icon im Prompt-Titel */
        .prompt-item .prompt-title-container { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }
        .prompt-item .prompt-title-icon { font-size: 1.2em; line-height: 1; /* Verhindert zu gro√üen Zeilenabstand */ }
        /* KONTRAST FIX: Farbe f√ºr strong in Prompt-Item */
        .prompt-item strong {
            display: block; font-weight: bold;
            color: var(--primary-color-darker); /* Dunkleres Blau f√ºr Kontrast */
            font-size: 1rem;
        }

        .prompt-item .description { font-size: var(--font-size-small); color: var(--text-muted); margin-bottom: 8px; line-height: 1.4; }
        .prompt-item .details { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
        .prompt-item .badge { display: inline-block; padding: 3px 10px; border-radius: var(--border-radius-large); font-size: 0.75rem; font-weight: bold; line-height: 1.3; }
        .prompt-item .category-badge { background-color: var(--secondary-color); color: var(--text-dark); }
        .prompt-item .age-badge { background-color: var(--primary-color); color: var(--text-light); }

        /* --- CHATBOT-AUSWAHL --- */
        .chatbot-options { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 10px; justify-content: flex-start; }
        .chatbot-option {
             display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* NEU: Vertikale Zentrierung f√ºr Icon und Name */
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-medium);
            padding: 15px; /* Beh√§lt oberen/linken/rechten Padding bei */
            padding-bottom: 35px; /* Beh√§lt Platz f√ºr Badges unten bei */
            cursor: pointer;
            transition: all var(--transition-speed) var(--transition-timing);
            width: 130px;
            background-color: var(--background-section);
            position: relative;
            overflow: hidden;
            box-sizing: border-box; /* NEU: F√ºr konsistentes Box-Modell */
        }
        .chatbot-option:hover { background-color: #f0fdfa; border-color: var(--primary-color); box-shadow: var(--shadow-medium); }
        .chatbot-option.selected { border-color: var(--border-color-selected); background-color: var(--background-selected); box-shadow: var(--shadow-selected); }
        .chatbot-option.selected::after { content: '‚úî'; position: absolute; top: 5px; right: 8px; font-size: 1.2rem; color: var(--primary-color-dark); font-weight: bold; }
        .chatbot-icon { width: 60px; height: 60px; margin-bottom: 12px; opacity: 0.9; }
        .chatbot-option input[type="radio"] { position: absolute; opacity: 0; width: 0; height: 0; pointer-events: none; }
        .recommendation-badge, .europe-badge {
            position: absolute; bottom: 5px; padding: 2px 6px; border-radius: var(--border-radius-small);
            font-size: 0.7rem; font-weight: bold; line-height: 1.2; text-align: center; white-space: nowrap;
        }
        .recommendation-badge { left: 5px; background-color: var(--success-color); color: var(--text-light); }
        .europe-badge { right: 5px; }

        .chatbot-name {
            font-size: var(--font-size-p); /* Urspr√ºnglich var(--font-size-h5), 1rem ist var(--font-size-p) */
            color: var(--text-dark);       /* Besserer Kontrast als var(--text-muted) */
            font-weight: bold;
            margin-top: 0;                 /* WICHTIG: Entfernt den gro√üen oberen Abstand */
            margin-bottom: 4px;            /* Kleiner Abstand nach unten (Badges sind absolut positioniert) */
            line-height: 1.3;
            text-align: center;            /* Stellt sicher, dass der Text zentriert ist */
        }
        /* --- PROMPT VORSCHAU & BEARBEITUNG --- */
        #prompt-preview-container { margin-top: 20px; padding: 20px; border: 1px solid var(--border-color); border-radius: var(--border-radius-medium); background-color: #f8f9fa; display: none; }
        #prompt-preview-container h3 { margin-top: 0; font-size: 1.1rem; color: var(--primary-color-darker); margin-bottom: 0.8rem;} /* War h4, angepasst an neue Hierarchie & Farbe */
        #prompt-preview-container p small { font-size: var(--font-size-small); color: var(--text-muted); line-height: 1.4; margin-bottom: 10px; display: block; }
        #prompt-preview-output {
             width: 100%; min-height: 180px; font-family: monospace; font-size: 0.9rem;
             border: 1px solid var(--border-color); border-radius: var(--border-radius-small);
             padding: 10px; margin-bottom: 15px; box-sizing: border-box; line-height: 1.4; background-color: #fff; resize: vertical; overflow-y: auto; cursor: text;
        }
        #prompt-preview-output:read-only { background-color: #e9ecef; cursor: not-allowed; }
        .prompt-preview-actions { display: flex; justify-content: flex-end; align-items: center; flex-wrap: wrap; gap: 10px; margin-top: 10px; flex-direction: column; } /* Added flex-direction column */

        /* --- BUTTONS / LINKS (als Buttons gestyled) --- */
        .action-buttons-container { text-align: center; margin-top: 20px; display: flex; flex-direction: column; align-items: center; gap: 10px; }

        /* Gemeinsame Stile f√ºr Haupt-Aktionslink & Sekund√§r-Button */
        .submit-btn, .secondary-cta {
            border: none; padding: 12px 25px; border-radius: var(--border-radius-medium); font-weight: bold; cursor: pointer; font-size: 1rem; transition: all var(--transition-speed) var(--transition-timing); box-shadow: var(--shadow-light); display: inline-block; width: auto; min-height: 48px; line-height: 1.4; vertical-align: middle; text-align: center; text-decoration: none; /* F√ºr Links */
        }

        /* Haupt-Aktionslink (ehemals submit-btn) */
        .submit-btn {
             background-color: var(--accent-color); color: var(--text-light); line-height: 48px;
        }
        .submit-btn:hover:not(.disabled) { background-color: #ea580c; transform: translateY(-2px); box-shadow: var(--shadow-medium); color: var(--text-light); text-decoration: none; }
        .submit-btn:active:not(.disabled) { transform: translateY(0) scale(0.98); box-shadow: var(--shadow-light); }

        /* Sekund√§r-Button (preview-edit-btn) */
        .secondary-cta {
            background-color: var(--text-muted); color: var(--text-light); padding: 10px 20px; font-size: 0.9rem;
        }
        .secondary-cta:hover:not(:disabled) { background-color: #555; color: var(--text-light); text-decoration: none; }

        /* Disabled-Zustand (wird via JS als Klasse gesetzt) */
        .submit-btn.disabled, .secondary-cta:disabled {
             background-color: #ccc !important; /* Wichtig, um Hover zu √ºberschreiben */
             color: #888 !important;
             cursor: not-allowed;
             transform: none !important;
             box-shadow: none !important;
             pointer-events: none; /* Verhindert Klick-Events */
        }

        .submit-btn.success-feedback, .secondary-cta.success-feedback { animation: successPulse 0.5s ease-out; }
        @keyframes successPulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); background-color: var(--success-color); } 100% { transform: scale(1); } }

        /* --- FOOTER --- */
        .footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border-color); color: var(--text-muted); font-size: var(--font-size-small); }
        .footer p { margin-bottom: 0.5rem; } .footer a { color: var(--text-muted); font-weight: bold; } .footer a:hover { color: var(--primary-color-dark); } .footer small { display: block; margin-top: 10px; line-height: 1.4; }

        /* --- Visually Hidden --- */
        .visually-hidden { position: absolute; width: 1px; height: 1px; margin: -1px; padding: 0; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }

        /* --- NEU: BUCH PROMOTION STILE --- */
        .book-promotion {
            background-color: var(--background-book-section);
            border: 1px solid var(--border-color-book-section);
            border-radius: var(--border-radius-medium);
            padding: 30px 40px;
            margin-top: 25px; /* Abstand nach oben */
            margin-bottom: 20px; /* Abstand nach unten */
            display: flex;
            flex-wrap: wrap; /* Umbruch auf kleinen Bildschirmen */
            gap: 20px; /* Abstand zwischen Bildern und Text */
            align-items: center; /* Vertikal zentrieren */
        }
        .book-images {
            display: flex;
            flex: 1 1 200px; /* Erlaubt Schrumpfen, Basisbreite 200px */
            justify-content: center; /* Bilder zentrieren, wenn Platz */
            min-width: 200px; /* Mindestbreite f√ºr den Bildcontainer */
        }
        .book-images img {
            max-height: 350px;
            width: auto;
            border-radius: var(--border-radius-small);
            box-shadow: var(--shadow-light);
            object-fit: contain;
        }
        .book-details {
            flex: 2 1 300px; /* Nimmt mehr Platz ein, Basisbreite 300px */
        }
        .book-details h3 {
            font-size: var(--font-size-h2);
            color: var(--primary-color-darker);
            margin-top: 0;
            margin-bottom: 10px;
        }
        .book-details p {
            margin-bottom: 10px;
            font-size: var(--font-size-p);
            line-height: var(--line-height-base);
        }
        .book-details .authors {
            font-style: italic;
            color: var(--text-muted);
            font-size: var(--font-size-small);
            margin-bottom: 15px;
        }
        .book-details .release-info {
            font-weight: bold;
            color: var(--accent-color);
            font-size: var(--font-size-p);
            margin-bottom: 15px;
        }
        .book-details .book-link {
            display: inline-block;
            background-color: var(--secondary-color);
            color: var(--text-dark);
            padding: 8px 15px;
            border-radius: var(--border-radius-medium);
            font-weight: bold;
            text-decoration: none;
            transition: all var(--transition-speed) ease;
            box-shadow: var(--shadow-light);
        }
        .book-details .book-link:hover {
            background-color: #ffae33; /* Etwas dunkleres Orange */
            color: var(--text-dark);
            text-decoration: none;
            transform: translateY(-1px);
            box-shadow: var(--shadow-medium);
        }

        /* Abschnitt Container */
        #datenschutz-hinweise {
            margin-top: 40px;  /* Abstand nach oben zum vorherigen Element */
            padding-top: 20px; /* Innenabstand oben */
        }

        /* √úberschriften */
        #datenschutz-hinweise h2 {
            margin-bottom: 20px; /* Abstand unter der Haupt√ºberschrift */
            /* Evtl. Schriftgr√∂√üe, Farbe etc. anpassen, falls nicht geerbt */
            font-size: 1.8em; /* Beispiel - anpassen! */
        }

        #datenschutz-hinweise h3 {
            margin-top: 30px; /* Abstand √ºber den Zwischen√ºberschriften */
            margin-bottom: 15px; /* Abstand unter den Zwischen√ºberschriften */
            /* Evtl. Schriftgr√∂√üe, Farbe etc. anpassen, falls nicht geerbt */
             font-size: 1.4em; /* Beispiel - anpassen! */
        }

        /* Abs√§tze */
        #datenschutz-hinweise p {
            margin-bottom: 15px; /* Abstand unter Abs√§tzen */
            line-height: 1.6;    /* Verbessert die Lesbarkeit */
        }

        /* Listen Allgemein */
        #datenschutz-hinweise ul,
        #datenschutz-hinweise ol {
            padding-left: 25px;   /* Einr√ºckung f√ºr Listenpunkte/Nummerierung */
            margin-bottom: 15px;  /* Abstand unter der gesamten Liste */
        }

        /* Listenelemente (Punkte/Nummern) */
        #datenschutz-hinweise li {
            margin-bottom: 8px; /* Abstand zwischen einzelnen Listenelementen */
            line-height: 1.6;   /* Verbessert die Lesbarkeit */
        }

        /* Spezifisch f√ºr die Haupt-Nummerierungsliste (Punkte 1-6) */
        #datenschutz-hinweise > ol > li {
            margin-bottom: 20px; /* Gr√∂√üerer Abstand zwischen den Hauptpunkten */
        }

        /* Verschachtelte Listen (Unterpunkte bei 1. und 3.) */
        #datenschutz-hinweise ul ul,
        #datenschutz-hinweise ol ul {
            margin-top: 10px;    /* Abstand √ºber der verschachtelten Liste */
            padding-left: 20px;  /* Zus√§tzliche Einr√ºckung f√ºr Verschachtelung */
            margin-bottom: 10px; /* Abstand unter der verschachtelten Liste */
        }

        #datenschutz { line-height: 1.2em; margin-top: 5px; }
        
        /* NEU: Clipboard Hinweis Styling */
        .clipboard-notice {
            background-color: #e6f7ff; /* Light blue background */
            border: 1px solid #91d5ff; /* Blue border */
            color: #0050b3; /* Dark blue text */
            padding: 10px 15px;
            border-radius: var(--border-radius-small);
            margin-bottom: 10px; /* Space before the button */
            font-size: var(--font-size-small);
            text-align: left;
            line-height: 1.4;
            width: 100%; /* Take full width of container */
            box-sizing: border-box; /* Include padding and border in width */
        }
        .clipboard-notice strong {
            color: #003a8c; /* Even darker blue for strong text */
        }

        /* --- NEU: Chatbot √úbersicht Tabelle Stile --- */
        .chatbot-overview-container {
            /* padding: 0 25px;  Match .accordion-content padding, wird durch section-header geregelt */
            margin-bottom: 30px; /* Mehr Abstand nach unten vor den Datenschutzhinweisen */
            margin-top: 30px; /* Abstand nach oben */
        }
        .chatbot-overview-container > h3 { /* Muss spezifischer sein als .accordion-content h3 */
            font-size: var(--font-size-h2); /* Gr√∂√üe wie andere Sektions-Haupt√ºberschriften */
            color: var(--primary-color-dark);
            margin-top: 0; /* Kein extra oberer Rand, da es die erste √úberschrift im Container ist */
            margin-bottom: 1.5rem; /* Standard Abstand unter √úberschrift */
            padding-bottom: 8px; /* Etwas mehr padding */
            border-bottom: 2px solid var(--primary-color);
        }
        .table-responsive-wrapper {
            overflow-x: auto; /* Macht Tabelle auf kleinen Screens horizontal scrollbar */
            width: 100%;
            margin-bottom: 1.5rem; /* Abstand nach der Tabelle */
        }
        #chatbot-summary-table {
            width: 100%;
            min-width: 700px; /* Mindestbreite bevor Scrollen einsetzt, um Umbr√ºche zu minimieren */
            border-collapse: collapse;
            /* margin: 1.5rem 0; /* Entfernt, da Wrapper Abstand hat */
            font-size: var(--font-size-small);
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-medium);
            /* overflow: hidden; /* Wichtig f√ºr border-radius, aber kann bei overflow-x st√∂ren, besser am Wrapper */
        }
        #chatbot-summary-table th,
        #chatbot-summary-table td {
            border-bottom: 1px solid var(--border-color);
            padding: 10px 12px;
            text-align: left;
            vertical-align: top;
            white-space: nowrap; /* Verhindert Umbruch in Zellen f√ºr bessere Lesbarkeit bei schmalen Spalten, au√üer bei Bedarf */
        }
        #chatbot-summary-table th {
            background-color: var(--background-prompt-item);
            font-weight: bold;
            color: var(--primary-color-dark);
            border-bottom-width: 2px;
        }
        #chatbot-summary-table tbody tr:nth-child(odd) {
            background-color: #fdfdfe; /* Etwas heller als Standard prompt-item f√ºr Abwechslung */
        }
        #chatbot-summary-table tbody tr:hover {
            background-color: var(--background-selected);
        }
        /* Spezifische Zellen k√∂nnen Umbruch erlauben, falls n√∂tig */
        #chatbot-summary-table td.allow-wrap,
        #chatbot-summary-table th.allow-wrap {
            white-space: normal;
        }
        /* Letzte Zeile ohne untere Border */
        #chatbot-summary-table tbody tr:last-child td {
            border-bottom: none;
        }
        .chatbot-legend {
            font-size: var(--font-size-small);
            /* margin-top: 1.5rem; /* Wird vom Wrapper Abstand oben geregelt */
            line-height: 1.5;
        }
        .chatbot-legend h4 {
            font-size: var(--font-size-h5); /* Etwas kleiner f√ºr Legenden√ºberschrift */
            color: var(--text-muted);
            margin-top: 0; /* Kein extra oberer Rand */
            margin-bottom: 0.8rem;
            font-weight: bold;
        }
        .chatbot-legend p {
            margin-bottom: 0.4rem; /* Kleinerer Abstand zwischen Legendenpunkten */
        }


        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 768px) {
            body { padding: 15px; } .container { padding: 0; }
            .header h1 { font-size: 2rem; } /* Responsive H1 */
            .section-header { padding: 15px 20px; }
            .section-header h2 { font-size: 1.5rem; }
            .accordion-header { padding: 15px 20px; font-size: 1.4rem; } /* Responsive H2 (Akkordeon) */
            .accordion-header::after { right: 20px; }
            .accordion-content { padding: 15px 20px; }
            .accordion-content.open { padding: 15px 20px; }
            .accordion-content h3 { font-size: 1.2rem; } /* Responsive H3 im Akkordeon */
            .accordion-content h4 { font-size: 1.1rem; } /* Responsive H4 im Akkordeon */
            .generic-prompts-container { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
            .filter-group-combined { flex-direction: column; align-items: stretch; gap: 10px; }
            .filter-group-combined .form-group { min-width: unset; }
            .chatbot-options { gap: 10px; justify-content: space-around; }
            .chatbot-option { width: 110px; padding: 12px; padding-bottom: 30px; }
            .chatbot-option.selected::after { top: 3px; right: 5px; font-size: 1rem; }
            .recommendation-badge, .europe-badge { font-size: 0.65rem; padding: 2px 4px; }
            /* Button/Link Anpassungen */
            .submit-btn, .secondary-cta { width: 100%; box-sizing: border-box; padding-left: 15px; padding-right: 15px; }
            #prompt-preview-output { min-height: 150px; }
            .prompt-preview-actions { flex-direction: column; align-items: stretch; } /* Ensures button and notice stack correctly */
            .back-btn { margin-bottom: 10px; }

            /* NEU: Responsive Buch-Sektion */
            .book-promotion {
                flex-direction: column; /* Untereinander auf kleineren Screens */
                align-items: stretch; /* Volle Breite f√ºr Elemente */
                padding: 15px;
            }
            .book-images {
                justify-content: center; /* Zentriert die Bilder */
                margin-bottom: 15px; /* Abstand zum Text */
                flex-basis: auto; /* Zur√ºcksetzen der Basisbreite */
            }
            .book-images img {
                max-width: 90px; /* Etwas kleinere Bilder */
            }
            .book-details {
                text-align: center; /* Text zentrieren */
                flex-basis: auto; /* Zur√ºcksetzen der Basisbreite */
            }
            .book-details .book-link {
                width: 100%; /* Button auf volle Breite */
                box-sizing: border-box;
                text-align: center;
            }
            /* Responsive Chatbot-√úbersichtstabelle */
            .chatbot-overview-container {
                padding: 0 15px; /* Weniger Padding auf Mobile */
            }
            #chatbot-summary-table {
                font-size: 0.75rem; /* Kleinere Schrift f√ºr Tabelle auf Mobile */
                min-width: 0; /* Erlaubt Schrumpfen, da scrollbar */
            }
            #chatbot-summary-table th,
            #chatbot-summary-table td {
                padding: 8px 10px; /* Weniger Padding in Zellen */
                 /* white-space: normal; /* Erlaubt Umbruch in Zellen auf Mobile, falls nowrap zu breit wird */
            }
        }
        @media (max-width: 480px) {
            body { padding: 10px; } .header { padding: 15px; }
            .header h1 { font-size: 1.6rem; } /* Responsive H1 */
            .section-header { padding: 10px 15px; }
            .section-header h2 { font-size: 1.3rem; }
            .accordion-header { padding: 12px 15px; font-size: 1.2rem; } /* Responsive H2 (Akkordeon) */
            .accordion-header::after { right: 15px; }
            .accordion-content { padding: 10px 15px; }
            .accordion-content.open { padding: 10px 15px; }
            .accordion-content h3 { font-size: 1.1rem; } /* Responsive H3 im Akkordeon */
            .accordion-content h4 { font-size: 1rem; } /* Responsive H4 im Akkordeon */
            .generic-prompts-container { grid-template-columns: 1fr; }
            .chatbot-options { justify-content: center; }
            /* *** √ÑNDERUNG HIER: Chatbot-Optionen auf voller Breite *** */
            .chatbot-option {
                 width: calc(50% - 5px);
                 box-sizing: border-box;
                 padding: 12px;
                 padding-bottom: 30px;
            }
            .chatbot-icon { width: 56px; height: 56px; margin-bottom: 12px; }
            .recommendation-badge, .europe-badge { font-size: 0.6rem; }
            .footer { font-size: 0.8rem; }

            /* NEU: Responsive Buch-Sektion (kleinere Screens) */
            .book-images img {
                max-width: 80px; /* Noch kleinere Bilder */
            }
            .book-details h3 {
                font-size: var(--font-size-h5); /* Kleinere √úberschrift */
            }
            .book-details p {
                font-size: var(--font-size-small); /* Kleinerer Text */
            }
             /* Chatbot-√úbersichtstabelle auf sehr kleinen Screens */
            #chatbot-summary-table th,
            #chatbot-summary-table td {
                padding: 6px 8px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header class="header">
            <h1><img src="kidsgpt-logo-min.png" alt="KidsGPT.eu - Dein KI-Helfer" class="logo"></h1>
        </header>

        <section class="section">
            <div class="section-header">
                <h2>Starte deine KI f√ºr Lernen, Spa√ü & Alltag!</h2>
                <p>W√§hle Schritt f√ºr Schritt einen Prompt und einen Chatbot, um loszulegen.</p>
                <p class="ki-hinweis-banner">
                    ‚ö†Ô∏è <strong>Wichtiger Hinweis:</strong> Bitte begleitet euer Kind bei der Nutzung ‚Äì dieses Tool ist <strong>nicht</strong> f√ºr die alleinige Nutzung durch Kinder gedacht! Mehr dazu in unserem Buch <a href="https://kai.im/kidsgpt-buch"
                    target="_blank" rel="noopener noreferrer external nofollow"><strong>‚ÄûKluge K√∂pfchen mit KI‚Äú</strong></a> (erscheint Herbst 2025) und im <a href="leitfaden.html" target="_blank"><strong>ausf√ºhrlichen Leitfaden</strong></a>. </p>
            </div>

            <form id="aiForm" onsubmit="return false;">

                <div class="accordion-section active-section" id="step-1-prompt">
                    <h2 class="accordion-header" tabindex="0" aria-expanded="true" aria-controls="step-1-content" onclick="toggleAccordion(1)">
                        Schritt 1: W√§hle einen Prompt
                    </h2>
                    <div class="accordion-content open" id="step-1-content" role="region" aria-labelledby="step-1-prompt">

                        <h3>Schnellstart: W√§hle eine allgemeine Unterst√ºtzung:</h3>
                        <div class="generic-prompts-container" id="generic-prompts-container">
                            <p style="text-align: center; padding: 10px; color: var(--text-muted);">Lade Schnellstart-Prompts...</p>
                        </div>

                        <hr class="section-divider">

                        <h3>Oder: St√∂bere zur Inspiration in der Prompt-Bibliothek:</h3>

                        <h4>Finde spezifische Prompts:</h4>
                        <div class="filter-group-combined">
                            <div class="form-group">
                                <label for="main-category-select">Bereich ausw√§hlen:</label>
                                <select id="main-category-select">
                                    <option value="Alle">‚ú® Alle Bereiche</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="prompt-search">Suche im Titel oder Beschreibung:</label>
                                <input type="search" id="prompt-search" placeholder="z.B. Bruchrechnung, Geschichte, Plan...">
                            </div>
                        </div>

                        <div id="prompt-library-list" role="listbox" aria-label="Prompt-Bibliothek zur Inspiration">
                            <p style="text-align: center; padding: 20px;">Lade Prompt-Bibliothek...</p>
                        </div>
                        <input type="hidden" id="selectedPromptId" name="selectedPromptId">
                        <span class="error-message" id="prompt-error" role="alert" aria-live="polite"></span>
                        <span class="feedback-message" id="action-feedback" role="status" aria-live="polite"></span>
                    </div>
                </div>

                <div class="accordion-section" id="step-2-chatbot">
                    <h2 class="accordion-header" tabindex="0" aria-expanded="false" aria-controls="step-2-content" onclick="toggleAccordion(2)">
                        Schritt 2: W√§hle einen Chatbot
                    </h2>
                    <div class="accordion-content" id="step-2-content" role="region" aria-labelledby="step-2-chatbot">
                        <button type="button" class="back-btn" onclick="updateAccordionState(1)">‚Üê Zur√ºck zu Schritt 1</button>

                        <div class="chatbot-options" role="radiogroup" aria-labelledby="chatbot-group-label">
                            <span id="chatbot-group-label" class="visually-hidden">Chatbot ausw√§hlen</span>
                            <label class="chatbot-option" tabindex="0" onclick="selectChatbot('mistral', this)" onkeydown="handleChatbotKeydown(event, 'mistral', this)" title="Starte einen Chat mit Le Chat (Mistral AI) - Empfehlung (KI aus Europa)">
                                <img src="mistral-ai.svg" alt="Mistral AI Logo" class="chatbot-icon">
                                <input type="radio" id="mistral" name="chatbot" value="mistral" class="visually-hidden">
                                <span class="chatbot-name">Le Chat</span>
                                <span class="recommendation-badge">Empfehlung</span>
                                <span class="europe-badge">üá™üá∫</span>
                            </label>
                            <label class="chatbot-option" tabindex="0" onclick="selectChatbot('chatgpt', this)" onkeydown="handleChatbotKeydown(event, 'chatgpt', this)" title="Starte einen Chat mit ChatGPT (OpenAI)">
                                <img src="ChatGPT_logo.svg" alt="ChatGPT Logo" class="chatbot-icon">
                                <input type="radio" id="chatgpt" name="chatbot" value="chatgpt" class="visually-hidden">
                                <span class="chatbot-name">ChatGPT</span>
                            </label>
                            <label class="chatbot-option" tabindex="0" onclick="selectChatbot('copilot', this)" onkeydown="handleChatbotKeydown(event, 'copilot', this)" title="Starte einen Chat mit Copilot (Microsoft)">
                                <img src="copilot-icon.svg" alt="Microsoft Copilot Logo" class="chatbot-icon">
                                <input type="radio" id="copilot" name="chatbot" value="copilot" class="visually-hidden">
                                <span class="chatbot-name">Copilot</span>
                            </label>
                            <label class="chatbot-option" tabindex="0" onclick="selectChatbot('claude', this)" onkeydown="handleChatbotKeydown(event, 'claude', this)" title="Starte einen Chat mit Claude (Anthropic)">
                                <img src="claude-ai-icon.svg" alt="Anthropic Claude Logo" class="chatbot-icon">
                                <input type="radio" id="claude" name="chatbot" value="claude" class="visually-hidden">
                                <span class="chatbot-name">Claude</span>
                            </label>
                            <label class="chatbot-option" tabindex="0" onclick="selectChatbot('gemini', this)" onkeydown="handleChatbotKeydown(event, 'gemini', this)" title="Starte einen Chat mit Google Gemini (Prompt wird in Zwischenablage kopiert)">
                                <img src="google-gemini-icon.svg" alt="Google Gemini Placeholder Logo" class="chatbot-icon"> <input type="radio" id="gemini" name="chatbot" value="gemini" class="visually-hidden">
                                <span class="chatbot-name">Gemini</span>
                            </label>
                            <label class="chatbot-option" tabindex="0" onclick="selectChatbot('duckai', this)" onkeydown="handleChatbotKeydown(event, 'duckai', this)" title="Starte einen Chat mit Duck.ai (DuckDuckGo) (Prompt wird in Zwischenablage kopiert)">
                                <img src="duck-ai-icon.svg" alt="Duck.ai Placeholder Logo" class="chatbot-icon"> <input type="radio" id="duckai" name="chatbot" value="duckai" class="visually-hidden">
                                <span class="chatbot-name">Duck.ai</span>
                            </label>
                        </div>
                        <span class="error-message" id="chatbot-error" role="alert" aria-live="polite"></span>
                    </div>
                </div>

                <div class="accordion-section" id="step-3-action">
                    <h2 class="accordion-header" tabindex="0" aria-expanded="false" aria-controls="step-3-content" onclick="toggleAccordion(3)">
                        Schritt 3: Chat starten
                    </h2>
                    <div class="accordion-content" id="step-3-content" role="region" aria-labelledby="step-3-action">
                        <button type="button" class="back-btn" onclick="updateAccordionState(2)">‚Üê Zur√ºck zu Schritt 2</button>

                        <div class="action-buttons-container">
                            <div class="clipboard-notice" id="clipboard-notice-step3" style="display: none;">
                                ‚ÑπÔ∏è <strong>Hinweis:</strong> Der Prompt wird in deine Zwischenablage kopiert.<br>Bitte f√ºge ihn manuell in den Chatbot ein, nachdem er sich ge√∂ffnet hat.
                            </div>
                            <a href="#" class="submit-btn disabled" id="start-chat-btn" role="button" tabindex="-1">
                                Prompt & Chatbot w√§hlen
                            </a>
                            <button type="button" class="secondary-cta" id="preview-edit-btn" onclick="showSelectedPromptPreview()" disabled>Prompt ansehen/√§ndern</button>
                            <span class="error-message" id="action-error" role="alert" aria-live="polite"></span>
                            <span class="feedback-message" id="action-feedback-step3" role="status" aria-live="polite"></span>
                        </div>

                        <div id="prompt-preview-container" style="display: none;">
                            <h3>Vorschau & Bearbeitung des finalen Prompts:</h3>
                            <p><small>Hier siehst du den vollst√§ndigen Prompt (inkl. System-Anweisungen und ggf. Kontextfragen), der an den Chatbot gesendet wird. Du kannst ihn vor dem Start anpassen.<br><strong>Wichtig:</strong> Bitte keine pers√∂nlichen Daten (Namen, Adressen etc.) hier eingeben!</small></p>
                            <label for="prompt-preview-output" class="visually-hidden">Vorschau und Bearbeitung des finalen Prompts</label>
                            <textarea id="prompt-preview-output" title="Vorschau und Bearbeitung des finalen Prompts..."></textarea>
                            <div class="prompt-preview-actions">
                                <div class="clipboard-notice" id="clipboard-notice-preview" style="display: none;">
                                    ‚ÑπÔ∏è <strong>Hinweis:</strong> Der Prompt wird in deine Zwischenablage kopiert. Bitte f√ºge ihn manuell in den Chatbot ein, nachdem er sich ge√∂ffnet hat.
                                </div>
                                <a href="#" class="submit-btn disabled" id="launch-chatbot-btn" role="button" style="display: none;" tabindex="-1">
                                    Chatbot mit diesem Prompt starten
                                </a>
                                </div>
                        </div>
                    </div>
                </div>

            </form>
        </section>

        <section class="section">
            <div class="section-header" style="border-bottom: none;">
                <h2>√úber dieses Projekt</h2>
                <p>
                    Dieses Tool entstand im Rahmen unseres Buches
                    <a href="https://kai.im/kidsgpt-buch" target="_blank" rel="noopener noreferrer external nofollow"><strong>‚ÄûKluge K√∂pfchen mit KI‚Äú</strong></a> <sup>*</sup> (erscheint Herbst 2025). Es bietet eine <strong>Bibliothek an erprobten Prompts</strong>                    f√ºr verschiedene Anl√§sse ‚Äì von Hausaufgabenhilfe √ºber kreative Spiele bis zur Alltagsorganisation.
                </p>
                <p>
                    <strong>W√§hle oben einen Schnellstart-Prompt</strong> f√ºr eine allgemeine Unterst√ºtzung oder st√∂bere zur Inspiration in der Bibliothek, um spezifischere Anwendungsf√§lle zu finden.
                </p>
                <p>
                    Anschlie√üend brauchst Du nur noch einen Chatbot auszuw√§hlen und auf den Button zu klicken, um mit deinem Prompt im gew√§hlten Chatbot zu starten. <em>Le Chat, ChatGPT und Copilot sind zum Ausprobieren kostenlos und ohne Anmeldung nutzbar. F√ºr Claude ist ein kostenloser Account n√∂tig. Gemini und Duck.ai k√∂nnen ebenfalls ohne Anmeldung genutzt werden; bei diesen wird der Prompt in die Zwischenablage kopiert, damit du ihn im Chatbot einf√ºgen kannst.</em>
                </p>
                <p>
                    Optional kannst du den finalen Prompt vorher √ºber ‚ÄûPrompt ansehen/√§ndern‚Äú pr√ºfen und bearbeiten und anschlie√üend damit den Chatbot deiner Wahl starten.
                </p>
                <div class="book-promotion">
                    <div class="book-details">
                        <h3>Unser Buch: ‚ÄûKluge K√∂pfchen mit KI‚Äú ‚Äì Der erste Elternratgeber zum Thema KI</h3>
                        <p class="authors">Von Kai Spriestersbach & Leonie Lutz</p>
                        <p>
                            KI ist gekommen, um zu bleiben ‚Äì und macht auch vor Kinderzimmern nicht Halt. Wir zeigen, wie ein sicherer und kreativer Umgang mit KI im Familien- und Schulalltag gelingt. Verstehe, wie KI funktioniert, entdecke bereichernde Tools f√ºrs Lernen und erhalte
                            praxisnahe Tipps f√ºr den Alltag ‚Äì immer mit kritischem Blick auf die Risiken.
                        </p>
                        <p class="release-info">Erscheint im Herbst 2025!</p>
                        <a href="https://kai.im/kidsgpt-buch" target="_blank" rel="noopener noreferrer external nofollow" class="book-link">Mehr erfahren & vormerken</a> <sup>*</sup>
                    </div>
                    <div class="book-images">
                        <a href="https://kai.im/kidsgpt-buch" target="_blank" rel="noopener noreferrer external nofollow"><img src="81TaWXeqD-L._SL1500_.jpg" alt="Buchcover ‚ÄûKluge K√∂pfchen mit KI‚Äú"></a><sup>*</sup>
                    </div>
                </div>

                <div id="datenschutz-hinweise">
                    <h2>Sicher und datensparsam mit Chatbots</h2>
                    <p>Liebe Eltern,</p>
                    <p>KI-Chatbots wie die hier empfohlenen k√∂nnen faszinierende Werkzeuge sein ‚Äì zum Lernen, Entdecken und Organisieren. Doch gerade wenn Kinder diese Technologien nutzen, ist der Schutz ihrer pers√∂nlichen Daten von gr√∂√üter Bedeutung. Hier
                        m√∂chten wir Ihnen das wichtige Prinzip der <strong>Datenvermeidung und Datensparsamkeit</strong> n√§herbringen und Ihnen praktische Tipps geben, wie Sie Chatbots m√∂glichst sicher nutzen ‚Äì allein und gemeinsam mit Ihren Kindern.</p>

                    <h3>Was bedeutet Datenvermeidung und Datensparsamkeit?</h3>
                    <ul>
                        <li><strong>Datenvermeidung:</strong> Versuchen Sie, die Eingabe pers√∂nlicher Daten von vornherein zu vermeiden, wo immer es m√∂glich ist.</li>
                        <li><strong>Datensparsamkeit:</strong> Geben Sie nur so viele Daten preis, wie f√ºr den jeweiligen Zweck unbedingt notwendig sind. Fragen Sie sich immer: Muss der Chatbot diese Information wirklich wissen, um meine Frage zu beantworten
                            oder die Aufgabe zu erf√ºllen?</li>
                    </ul>

                    <h3>Warum ist das wichtig?</h3>
                    <p>Jede Information, die Sie oder Ihr Kind einem Chatbot mitteilen, k√∂nnte theoretisch gespeichert, analysiert oder im Falle eines Datenlecks offengelegt werden. Besonders bei Kindern ist Vorsicht geboten, da sie die Tragweite der Datenweitergabe
                        oft noch nicht einsch√§tzen k√∂nnen. Datensparsamkeit minimiert das Risiko und sch√ºtzt Ihre Privatsph√§re.</p>

                    <h3>Praktische Tipps f√ºr die datensparsame Nutzung von Chatbots:</h3>
                    <ol>
                        <li>
                            <strong>Keine pers√∂nlichen Identifikationsdaten eingeben:</strong>
                            <br> Das Wichtigste zuerst: Geben Sie <strong>niemals</strong> sensible pers√∂nliche Daten in einen Chatbot ein.
                            <br> Dazu geh√∂ren:
                            <ul>
                                <li>Vollst√§ndige Namen (von Ihnen, Ihren Kindern, Freunden, Lehrern)</li>
                                <li>Genaue Adressen oder Wohnorte</li>
                                <li>Telefonnummern oder E-Mail-Adressen</li>
                                <li>Geburtsdaten</li>
                                <li>Namen von Schulen, Kinderg√§rten oder Vereinen</li>
                                <li>Passw√∂rter oder Zugangsdaten jeglicher Art</li>
                                <li>Gesundheitsinformationen oder andere sensible Details</li>
                                <li>Fotos von Personen (es sei denn, der Chatbot bietet eine sichere, explizite Funktion daf√ºr und Sie verstehen die Risiken)</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Formulieren Sie Anfragen allgemein:</strong> Anstatt zu schreiben: ‚ÄûMein Sohn Max, 9 Jahre, aus der 4a der Grundschule Musterstadt, braucht Hilfe bei den Hausaufgaben in Mathe zum Thema XYZ‚Äú, formulieren Sie es neutral:
                            ‚ÄûErkl√§re das Mathe-Thema XYZ f√ºr ein 9-j√§hriges Kind in der 4. Klasse einer Grundschule.‚Äú Der Chatbot ben√∂tigt keine pers√∂nlichen Details, um die Aufgabe zu erf√ºllen.
                        </li>
                        <li>
                            <strong>Seien Sie vorsichtig bei Konten und Logins:</strong>
                            <ul>
                                <li>Manche Chatbots erfordern ein Konto. Wenn m√∂glich, nutzen Sie eine separate E-Mail-Adresse, die nicht direkt mit Ihrem Namen oder anderen pers√∂nlichen Konten verkn√ºpft ist.</li>
                                <li>Pr√ºfen Sie, ob der Chatbot auch ohne Login genutzt werden kann.</li>
                                <li>Informieren Sie sich, ob und wie Sie Ihre Daten und den Chatverlauf l√∂schen k√∂nnen und tun Sie dies regelm√§√üig.</li>
                                <li>Falls der Chatbot Einstellungen zur Datennutzung bietet (z.B. zur Verbesserung des Dienstes), pr√ºfen Sie diese und deaktivieren Sie optionales Datensammeln, wenn Sie Bedenken haben.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>W√§hlen Sie den Anbieter bewusst:</strong> Achten Sie auf die Datenschutzbestimmungen des Anbieters. Wir empfehlen ‚ÄûLe Chat‚Äú von Mistral AI, da dieser europ√§ische Anbieter sich zur Einhaltung der strengen europ√§ischen
                            Datenschutzgrundverordnung (DSGVO) verpflichtet hat. Dennoch gilt auch hier: Seien Sie datensparsam!
                        </li>
                        <li>
                            <strong>Sprechen Sie mit Ihrem Kind:</strong> Erkl√§ren Sie Ihrem Kind altersgerecht, <em>warum</em> es wichtig ist, keine pers√∂nlichen Informationen im Internet preiszugeben ‚Äì auch nicht gegen√ºber einem freundlich wirkenden
                            Chatbot. Machen Sie klare Regeln zur gemeinsamen Nutzung und zur Art der Informationen, die geteilt werden d√ºrfen (n√§mlich m√∂glichst keine pers√∂nlichen).
                        </li>
                    </ol>
                    <h3>Warum wir Le Chat empfehlen</h3>
                    <p>
                        Wenn Kinder und Jugendliche erste Schritte mit K√ºnstlicher Intelligenz machen, ist es wichtig, dass sie auf ein sicheres, leistungsstarkes und verst√§ndliches Tool zur√ºckgreifen k√∂nnen. Genau deshalb empfehlen wir <strong>‚ÄûLe Chat‚Äú von Mistral AI</strong>.
                    </p>
                    <p>
                        Le Chat ist ein kostenloser KI-Assistent aus Europa, der nicht nur zuverl√§ssig, sondern auch sehr vielseitig ist ‚Äì ganz ohne Anmeldung, ohne Werbung und mit Funktionen, die besonders im Bildungsbereich sinnvoll sind.
                    </p>
                    <p>
                        <strong>Ein gro√üer Pluspunkt:</strong> Mistral AI ist ein Unternehmen aus Frankreich. Das bedeutet: Die Verarbeitung von Daten unterliegt den strengen Regelungen der <abbr title="Datenschutz-Grundverordnung">DSGVO</abbr>. Gerade
                        im Vergleich zu vielen US-basierten KI-Diensten ist das ein echter Vorteil ‚Äì besonders, wenn Kinder und Jugendliche beteiligt sind. Le Chat funktioniert au√üerdem ohne Account, sodass keine personenbezogenen Daten erhoben werden
                        m√ºssen.
                    </p>
                    <ul>
                        <li>
                            <strong>üîç Antworten mit Quellenangabe:</strong>
                            <br> Le Chat verbindet KI-gest√ºtzte Antworten mit aktuellen Informationen aus dem Netz ‚Äì inklusive Zitaten. Ideal f√ºr Rechercheaufgaben, Pr√§sentationen oder Projektarbeit.
                        </li>
                        <li>
                            <strong>üìÑ PDFs & Bilder analysieren:</strong>
                            <br> Le Chat erkennt Tabellen, Formeln, Diagramme oder Texte in komplexen Dokumenten ‚Äì und erkl√§rt sie verst√§ndlich. Das spart Zeit und hilft beim Lernen.
                        </li>
                        <li>
                            <strong>üß† Ideen entwickeln & Inhalte gestalten:</strong>
                            <br> Mit dem sogenannten ‚ÄûCanvas‚Äú k√∂nnen gemeinsam mit der KI Texte erstellt, bearbeitet oder weiterentwickelt werden ‚Äì ob f√ºr ein Referat, ein Arbeitsblatt oder kreative Aufgaben.
                        </li>
                        <li>
                            <strong>üé® Bilder generieren:</strong>
                            <br> Kinder k√∂nnen eigene Bilder gestalten oder visuelle Elemente f√ºr ihre Arbeiten erzeugen ‚Äì ganz einfach per Texteingabe.
                        </li>
                        <li>
                            <strong>üí∏ Kostenlos und ohne Registrierung:</strong>
                            <br> Aktuell stehen alle Funktionen von Le Chat frei zur Verf√ºgung ‚Äì ein echtes Plus f√ºr den schulischen oder famili√§ren Einsatz.
                        </li>
                    </ul>
                    <p>
                        Le Chat vereint modernste KI mit einem klaren Fokus auf Sicherheit, Nutzbarkeit und Verantwortung. Das macht es zur idealen Wahl f√ºr alle, die Kinder beim Erkunden von KI sicher begleiten wollen ‚Äì sei es zu Hause oder im Klassenzimmer.
                    </p>
                    <p>
                        M√∂chtest du mehr √ºber das clevere Anweisen von KIs lernen? Schau in unseren
                        <strong><a href="leitfaden.html" target="_blank">ausf√ºhrlichen KI-Promptingkurs f√ºr Eltern</a></strong>!
                    </p>
                </div>
                <div class="chatbot-overview-container">
                    <h3>Welche Chatbots sind kostenlos und sicher?</h3>
                    <div class="table-responsive-wrapper">
                        <table id="chatbot-summary-table">
                          <thead>
                            <tr>
                              <th>Tool</th>
                              <th>Anbieter</th>
                              <th>Alter</th>
                              <th>Kostenlos?</th>
                              <th>Anmeldung</th>
                              <th>Training</th>
                              <th>Opt-Out</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td><strong>Le Chat</strong></td>
                              <td>Mistral üá´üá∑</td>
                              <td>13<sup>*</sup></td>
                              <td>üü°</td>
                              <td>‚ùå</td>
                              <td>‚ö†Ô∏è</td>
                              <td>‚úÖ</td>
                            </tr>
                            <tr>
                              <td><strong>ChatGPT</strong></td>
                              <td>OpenAI üá∫üá∏</td>
                              <td>13<sup>*</sup></td>
                              <td>üü°</td>
                              <td>üü°</td>
                              <td>‚ö†Ô∏è</td>
                              <td>‚úÖ</td>
                            </tr>
                            <tr>
                              <td><strong>Copilot</strong></td>
                              <td>Microsoft üá∫üá∏</td>
                              <td>üá©üá™ 16 / üá¶üáπ 14 / üá®üá≠ 13</td>
                              <td>üü°</td>
                              <td>üü°</td>
                              <td>‚ö†Ô∏è*</td>
                              <td>‚úÖ</td>
                            </tr>
                            <tr>
                              <td><strong>Claude</strong></td>
                              <td>Anthropic üá∫üá∏</td>
                              <td>18</td>
                              <td>üü°</td>
                              <td>‚ùå</td>
                              <td>üîí</td>
                              <td>‚úÖ (Opt-In)</td>
                            </tr>
                            <tr>
                              <td><strong>Gemini</strong></td>
                              <td>Google üá∫üá∏</td>
                              <td>üá©üá™ 16 / üá¶üáπ 14 / üá®üá≠ 13</td>
                              <td>üü°</td>
                              <td>‚ùå</td>
                              <td>‚ö†Ô∏è</td>
                              <td>‚úÖ</td>
                            </tr>
                            <tr>
                              <td><strong>Duck.ai</strong></td>
                              <td>DuckDuckGo üá∫üá∏</td>
                              <td>13<sup>*</sup></td>
                              <td>‚úÖ</td>
                              <td>‚úÖ</td>
                              <td>üîí</td>
                              <td>‚Äì</td>
                            </tr>
                          </tbody>
                        </table>
                    </div>
                    <div class="chatbot-legend">
                        <h4>Legende:</h4>
                        <ul>
                          <li>‚úÖ = Ja / Trifft zu</li>
                          <li>‚ùå = Nein / Trifft nicht zu</li>
                          <li>üü° = Eingeschr√§nkt</li>
                          <li>13<sup>*</sup> = Ab 13 mit Erlaubnis der Eltern/Erziehungsberechtigten</li>
                          <li>‚ö†Ô∏è = Achtung: Daten werden f√ºrs KI-Training genutzt</li>
                          <li>‚ö†Ô∏è<sup>*</sup> = Anonymisierte Trainingsdaten</li>
                          <li>üîí = Sicher, da kein Training laut Anbieter</li>
                          <li>Opt-Out = M√∂glichkeit, der Datennutzung zu widersprechen</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <p id="datenschutz">
                <small><strong>Datenschutzhinweis:</strong> Diese Webseite selbst speichert keine pers√∂nlichen Daten oder Eingaben von dir. Wenn du auf ‚ÄûChatbot starten‚Äú oder ‚ÄûChatbot mit diesem Prompt starten‚Äú klickst, wird der ausgew√§hlte (oder bearbeitete) Prompt an den externen Chatbot-Anbieter (z.B. Mistral AI, OpenAI, Microsoft, Anthropic, Google, DuckDuckGo) √ºbermittelt bzw. in deine Zwischenablage kopiert und dessen Webseite in einem neuen Tab ge√∂ffnet. Ab diesem Moment gelten die Datenschutzbestimmungen und Nutzungsbedingungen des jeweiligen Anbieters. Sei dir bewusst, dass die Anbieter deine Eingaben m√∂glicherweise zur Verbesserung ihrer Dienste verwenden.</small>
            </p>
            <p><small>F√ºr Ideen, Anregungen oder Feedback: &#107;&#097;&#105;&#064;&#097;&#102;&#097;&#105;&#107;&#046;&#100;&#101;</small></p>
        </section>
        <footer class="footer">
            <p>&copy; 2025 <a hrefs="https://www.afaik.de/kai-spriestersbach/" target="_blank" rel="noopener noreferrer external">Kai Spriestersbach</a> | Die Webseite zum Buch ‚ÄûKluge K√∂pfchen mit KI‚Äú</p>
            <p><small>Stand der Prompts: 19. April 2025 ‚Äì Barrierefreiheit gepr√ºft nach: WCAG 2.2</small></p>
            <p>
                <a href="https://www.w3.org/WAI/WCAG2AAA-Conformance" title="Explanation of WCAG 2 Level AAA conformance" target="_blank" rel="noopener noreferrer external">
                    <img height="32" width="88" src="https://www.w3.org/WAI/WCAG22/wcag2.2AAA" alt="Level AAA conformance,
            W3C WAI Web Content Accessibility Guidelines 2.2">
                </a>
            </p>
            <p id="impressum" style="margin-top: 15px;">Anbieter: Kai Spriestersbach, Galgen√§cker 7, 97903 Collenberg, &#107;&#097;&#105;&#064;&#097;&#102;&#097;&#105;&#107;&#046;&#100;&#101;</p>
            <p><small><sup>*</sup> Partner-Link. Kaufst Du dar√ºber, erhalte ich ggf. eine Provision ohne Mehrkosten f√ºr Dich. Danke!</small></p>
        </footer>
    </div>

    <script>
        // --- Globale Variablen ---
        const botDescription = "Du bist ein freundlicher, einf√ºhlsamer Chatbot f√ºr Kinder und Jugendliche. Sprich stets in einfacher, klarer und altersgerechter Sprache. Wenn das Kind oder der*die Jugendliche ein emotionales, nicht-fachliches Problem anspricht (z.B. √Ñngste, Unsicherheiten oder Sorgen rund ums Lernen oder Sprechen), dann wechsle in einen einf√ºhlsamen, unterst√ºtzenden Modus. Zeige Verst√§ndnis, stelle offene, sanfte R√ºckfragen (z.B. ‚ÄûMagst du mir etwas genauer erz√§hlen, was dir Sorgen macht?‚Äú oder ‚ÄûWas ist das, was dir am schwersten f√§llt?‚Äú) und best√§rke das Kind oder den*die Jugendliche*n (‚ÄûDas ist v√∂llig okay. Ich bin f√ºr dich da ‚Äì wir schaffen das gemeinsam.‚Äú). Nimm die Gef√ºhle ernst, ohne zu dramatisieren, und biete ermutigende, st√§rkende Worte an. Du darfst dabei ruhig freundlich motivierend sein, z.B.: ‚ÄûIch verstehe dich. Lass uns einfach mal anfangen ‚Äì wir schauen gemeinsam, wie es klappt, okay?‚Äú Ziel ist es, emotionale Sicherheit und Mut zu vermitteln, bevor inhaltlich weitergearbeitet wird. #WICHTIG: Achte immer darauf, nur Informationen und Inhalte weiterzugeben, die f√ºr Kinder und Jugendliche geeignet und verst√§ndlich sind! Wenn du merkst, dass ein Kind oder ein*e Jugendliche*r Fragen stellt oder Themen anspricht, die nicht altersgerecht, sensibel oder pers√∂nlich/intim sind, antworte nicht direkt darauf! Stattdessen ermutige die Person, sich vertrauensvoll an seine Eltern oder andere Vertrauens- oder Bezugspersonen oder die ‚ÄûNummer gegen Kummer‚Äú zu wenden. Gib dabei folgende Informationen klar und freundlich weiter: ##Nummer gegen Kummer ‚Äì Wir h√∂ren dir zu: ###Kinder- und Jugendtelefon: F√ºr Kinder & Jugendliche. Anonym & kostenlos. Ruf uns an: 116 111 Du kannst bei uns √ºber alles sprechen, egal worum es geht. ###Elterntelefon: F√ºr alle Erziehenden. Anonym & kostenlos. Ruf an: 0800 111 0550 Sprich mit uns √ºber deine Familiensorgen. Wichtig: Achte immer darauf, Sicherheit, Vertrauen und F√ºrsorge zu vermitteln. Stelle keine pers√∂nlichen Fragen und speichere keine pers√∂nlichen Informationen. Dein Ziel ist es, Kinder und Jugendliche zu unterst√ºtzen ‚Äì sicher, altersgerecht und verantwortungsvoll.";
        let allPrompts = [];
        let genericPrompts = [];
        let filteredPrompts = [];
        let selectedPrompt = null;
        let selectedMainCategory = 'Alle';
        let currentStep = 1;
        let validatedData = {
            selectedPromptId: '',
            selectedChatbot: '',
            selectedChatbotName: ''
        };
        const defaultButtonText = "Prompt & Chatbot w√§hlen";
        const categoryIcons = {
            'Lernen & Schule': 'üéì',
            'Lernstrategien & Coaching': 'üí°',
            'Kreativit√§t & Geschichten': 'üé®',
            'Spiel & Spa√ü': 'üé≤',
            'Alltag & Organisation': 'üìÖ',
            'Etwas Neues lernen': 'üöÄ',
            'Auf der H√∂he bleiben': 'üîÑ',
            'Gelerntes anwenden': 'üéØ',
            'Probleme l√∂sen': 'üß©',
            'Ver√§nderungen mitgestalten': 'ü§ù',
            'Organisation & Planung': 'üìà',
            'Soziales & Kommunikation': 'üí¨',
            'default': '‚ú®'
        };
        const bookUrl = "https://kai.im/kidsgpt-buch"; // Buch-URL f√ºr die Weiterleitung

        // --- DOM-Element Referenzen ---
        const genericPromptsContainer = document.getElementById('generic-prompts-container');
        const mainCategorySelect = document.getElementById('main-category-select');
        const promptSearchInput = document.getElementById('prompt-search');
        const promptListContainer = document.getElementById('prompt-library-list');
        const selectedPromptIdInput = document.getElementById('selectedPromptId');
        const promptErrorSpan = document.getElementById('prompt-error');
        const chatbotErrorSpan = document.getElementById('chatbot-error');
        const actionErrorSpan = document.getElementById('action-error');
        const actionFeedbackSpan = document.getElementById('action-feedback');
        const actionFeedbackSpanStep3 = document.getElementById('action-feedback-step3');
        const step1Section = document.getElementById('step-1-prompt');
        const step1Content = document.getElementById('step-1-content');
        const step2Section = document.getElementById('step-2-chatbot');
        const step2Content = document.getElementById('step-2-content');
        const step3Section = document.getElementById('step-3-action');
        const step3Content = document.getElementById('step-3-content');
        const startChatAnchor = document.getElementById('start-chat-btn');
        const launchChatbotAnchor = document.getElementById('launch-chatbot-btn');
        const previewEditBtn = document.getElementById('preview-edit-btn');
        const promptPreviewContainer = document.getElementById('prompt-preview-container');
        const promptPreviewOutput = document.getElementById('prompt-preview-output');
        const aiForm = document.getElementById('aiForm');
        const clipboardNoticeStep3 = document.getElementById('clipboard-notice-step3');
        const clipboardNoticePreview = document.getElementById('clipboard-notice-preview');


        // --- AKKORDEON & NAVIGATION FUNKTIONEN ---
        function updateAccordionState(targetStep) {
            if (targetStep > currentStep) {
                if (currentStep === 1 && !validateStep1()) return;
                if (currentStep === 2 && !validateStep2()) return;
            }
            const sections = [step1Section, step2Section, step3Section];
            const contents = [step1Content, step2Content, step3Content];
            const headers = sections.map(s => s.querySelector('.accordion-header'));

            sections.forEach((section, index) => {
                const step = index + 1;
                const content = contents[index];
                const header = headers[index];
                section.classList.remove('active-section', 'next-section-highlight', 'completed-section');
                header.setAttribute('aria-expanded', 'false');
                content.classList.remove('open');
                content.style.maxHeight = null;
                if (step === targetStep) {
                    section.classList.add('active-section');
                    header.setAttribute('aria-expanded', 'true');
                    content.classList.add('open');
                     requestAnimationFrame(() => { if (content && content.scrollHeight) { content.style.maxHeight = content.scrollHeight + "px"; } });
                } else if (step < targetStep) { section.classList.add('completed-section'); }
            });
            if (targetStep < sections.length && validateStep1() && (targetStep === 1 || validateStep2())) { sections[targetStep].classList.add('next-section-highlight'); }
            currentStep = targetStep;
            if (sections[targetStep - 1].classList.contains('active-section')) {
                focusOnSection(targetStep);
            }
            updateActionButtonState();
             if (targetStep < 3) { resetPreview(); }
        }

        function toggleAccordion(stepToToggle) {
            const section = document.getElementById(`step-${stepToToggle}-prompt`) || document.getElementById(`step-${stepToToggle}-chatbot`) || document.getElementById(`step-${stepToToggle}-action`);
             if (typeof event !== 'undefined' && event && !(event.target.classList.contains('accordion-header') || event.target.closest('.accordion-header') === section.querySelector('.accordion-header'))) { if (!event.target.closest('.accordion-header')) { return; } }
             if (stepToToggle === currentStep) return;
            if (section.classList.contains('completed-section') || stepToToggle === currentStep + 1) { updateAccordionState(stepToToggle); }
            else if (stepToToggle < currentStep) { updateAccordionState(stepToToggle); }
        }

        function focusOnSection(step) {
            let firstFocusableElement = null;
            const sectionContent = document.getElementById(`step-${step}-content`);
            if (!sectionContent) return;

            if (step === 1) {
                firstFocusableElement = genericPromptsContainer.querySelector('.generic-prompt-card[aria-pressed="true"]')
                                     || genericPromptsContainer.querySelector('.generic-prompt-card')
                                     || mainCategorySelect
                                     || promptSearchInput;
            } else if (step === 2) {
                firstFocusableElement = sectionContent.querySelector('.back-btn')
                                     || sectionContent.querySelector('.chatbot-option');
            } else if (step === 3) {
                 const backBtn = sectionContent.querySelector('.back-btn');
                 if (promptPreviewContainer.style.display === 'block') {
                     firstFocusableElement = backBtn || (clipboardNoticePreview.style.display === 'block' ? clipboardNoticePreview : null) || promptPreviewOutput || launchChatbotAnchor;
                 } else {
                     firstFocusableElement = backBtn || (clipboardNoticeStep3.style.display === 'block' ? clipboardNoticeStep3 : null) || startChatAnchor || previewEditBtn;
                 }
            }
            
            // Filter out nulls in case notices are hidden
            if (Array.isArray(firstFocusableElement)) {
                firstFocusableElement = firstFocusableElement.find(el => el);
            }


            if (firstFocusableElement) {
                 setTimeout(() => {
                     const header = document.getElementById(`step-${step}-action`)?.querySelector('.accordion-header')
                               || document.getElementById(`step-${step}-chatbot`)?.querySelector('.accordion-header')
                               || document.getElementById(`step-${step}-prompt`)?.querySelector('.accordion-header');

                     if (header) {
                         header.scrollIntoView({ behavior: 'smooth', block: 'start' });
                     }

                     if (firstFocusableElement.offsetWidth > 0 || firstFocusableElement.offsetHeight > 0) {
                         if (!firstFocusableElement.classList?.contains('disabled') && firstFocusableElement.getAttribute('tabindex') !== '-1' && !firstFocusableElement.disabled) {
                              firstFocusableElement.focus({ preventScroll: true });
                         } else if (header) { 
                             header.focus({ preventScroll: true });
                         }
                     } else if (header) {
                         header.focus({ preventScroll: true });
                     }
                 }, 350);
            }
        }

        // --- HILFSFUNKTIONEN & EVENT HANDLER ---
        function handleChatbotKeydown(event, chatbotId, element) {
             if (event.key === 'Enter' || event.key === ' ') { event.preventDefault(); selectChatbot(chatbotId, element.closest('.chatbot-option')); }
        }
        function selectChatbot(chatbotId, element) {
             if (!element || !element.classList.contains('chatbot-option')) { return; }
            document.querySelectorAll('.chatbot-option').forEach(option => { option.classList.remove('selected'); option.setAttribute('aria-checked', 'false'); const radio = option.querySelector('input[type="radio"]'); if (radio) radio.checked = false; });
            element.classList.add('selected'); element.setAttribute('aria-checked', 'true');
            const radioInput = element.querySelector('input[type="radio"]');
            if (radioInput) { validatedData.selectedChatbot = radioInput.value; } else { validatedData.selectedChatbot = ''; }
            const chatbotNameElement = element.querySelector('.chatbot-name'); validatedData.selectedChatbotName = chatbotNameElement ? chatbotNameElement.textContent.trim() : '';
            hideError(chatbotErrorSpan); hideFeedback();
             if(validateStep2()){ updateAccordionState(3); } else { updateActionButtonState(); }
        }
        function resetPreview() {
             promptPreviewContainer.style.display = 'none';
             launchChatbotAnchor.style.display = 'none'; 
             if (clipboardNoticePreview) clipboardNoticePreview.style.display = 'none';
             if (currentStep === 3) {
                 startChatAnchor.style.display = 'inline-block'; 
                 previewEditBtn.style.display = 'inline-block';
                 // updateActionButtonState will handle clipboardNoticeStep3 visibility
             }
             promptPreviewOutput.value = '';
             promptPreviewOutput.readOnly = true;
             promptPreviewOutput.style.cursor = 'not-allowed';
             promptPreviewOutput.style.backgroundColor = '#e9ecef';
             updateActionButtonState(); // Ensure button and notice states are correct
             if (step3Content.classList.contains('open')) {
                 requestAnimationFrame(() => { if (step3Content && step3Content.scrollHeight) { step3Content.style.maxHeight = step3Content.scrollHeight + "px"; } });
             }
        }

        function updateActionButtonState() {
            const isPromptSelected = selectedPrompt !== null;
            const isChatbotSelected = validatedData.selectedChatbot !== '';
            const enabled = isPromptSelected && isChatbotSelected;

            previewEditBtn.disabled = !enabled;
            previewEditBtn.textContent = 'Prompt ansehen/√§ndern';

            if (enabled) {
                startChatAnchor.classList.remove('disabled');
                startChatAnchor.setAttribute('tabindex', '0');
                startChatAnchor.removeAttribute('aria-disabled');
                const promptTitle = selectedPrompt.title || '';
                const chatbotName = validatedData.selectedChatbotName;
                const shortTitle = promptTitle.length > 25 ? promptTitle.substring(0, 22) + '...' : promptTitle;
                startChatAnchor.textContent = `‚Äû${shortTitle}‚Äú in ${chatbotName} starten`;
                startChatAnchor.href = '#'; 
            } else {
                startChatAnchor.classList.add('disabled');
                startChatAnchor.setAttribute('tabindex', '-1');
                startChatAnchor.setAttribute('aria-disabled', 'true'); 
                startChatAnchor.textContent = defaultButtonText;
                startChatAnchor.removeAttribute('href'); 
            }

            const isPreviewVisible = promptPreviewContainer.style.display === 'block';
            const isPreviewPromptValid = promptPreviewOutput.value.trim() !== '';

            if (isPreviewVisible && enabled && isPreviewPromptValid) {
                launchChatbotAnchor.classList.remove('disabled');
                launchChatbotAnchor.setAttribute('tabindex', '0');
                launchChatbotAnchor.removeAttribute('aria-disabled');
                launchChatbotAnchor.textContent = `Chatbot mit diesem Prompt starten`;
                launchChatbotAnchor.href = '#'; 
            } else {
                launchChatbotAnchor.classList.add('disabled');
                launchChatbotAnchor.setAttribute('tabindex', '-1');
                launchChatbotAnchor.setAttribute('aria-disabled', 'true');
                launchChatbotAnchor.textContent = 'Chatbot mit diesem Prompt starten';
                launchChatbotAnchor.removeAttribute('href');
            }

            // Control visibility of main action elements vs preview elements
            if (currentStep === 3) {
                if (isPreviewVisible) {
                    startChatAnchor.style.display = 'none';
                    previewEditBtn.style.display = 'none';
                    launchChatbotAnchor.style.display = 'inline-block';
                } else {
                    startChatAnchor.style.display = 'inline-block';
                    previewEditBtn.style.display = 'inline-block';
                    launchChatbotAnchor.style.display = 'none';
                }
            } else { // Not in step 3, ensure correct default visibility
                startChatAnchor.style.display = 'inline-block';
                previewEditBtn.style.display = 'inline-block';
                launchChatbotAnchor.style.display = 'none';
            }

            // Control visibility of clipboard notices
            const showClipboardNoticeCondition = (validatedData.selectedChatbot === 'gemini' || validatedData.selectedChatbot === 'duckai');

            if (currentStep === 3) {
                if (isPreviewVisible) {
                    if (clipboardNoticePreview) {
                        clipboardNoticePreview.style.display = showClipboardNoticeCondition && enabled && isPreviewPromptValid ? 'block' : 'none';
                    }
                    if (clipboardNoticeStep3) {
                         clipboardNoticeStep3.style.display = 'none';
                    }
                } else { // Main action buttons in Step 3 are visible
                    if (clipboardNoticeStep3) {
                        clipboardNoticeStep3.style.display = showClipboardNoticeCondition && enabled ? 'block' : 'none';
                    }
                    if (clipboardNoticePreview) {
                        clipboardNoticePreview.style.display = 'none';
                    }
                }
            } else { // Not in Step 3, hide both notices
                if (clipboardNoticeStep3) clipboardNoticeStep3.style.display = 'none';
                if (clipboardNoticePreview) clipboardNoticePreview.style.display = 'none';
            }
             // Adjust accordion height if notice changes visibility and step 3 is open
            if (currentStep === 3 && step3Content.classList.contains('open')) {
                requestAnimationFrame(() => {
                    if (step3Content && step3Content.scrollHeight) {
                        step3Content.style.maxHeight = step3Content.scrollHeight + "px";
                    }
                });
            }
        }

        function showError(errorSpan, message, focusElement = null) {
             hideFeedback();
             errorSpan.textContent = message; errorSpan.style.display = 'block'; void errorSpan.offsetWidth; errorSpan.classList.add('visible');
             if (focusElement) { setTimeout(() => { if (focusElement.offsetWidth > 0 || focusElement.offsetHeight > 0) { if (!focusElement.classList?.contains('disabled') && focusElement.getAttribute('tabindex') !== '-1' && !focusElement.disabled) { focusElement.focus({ preventScroll: true }); } } }, 50); }
         }
        function hideError(errorSpan) {
            if (!errorSpan) return; errorSpan.classList.remove('visible'); setTimeout(() => { if (!errorSpan.classList.contains('visible')) { errorSpan.textContent = ''; errorSpan.style.display = 'none'; } }, 300);
         }
        function showFeedback(message, duration = 2500) {
            hideError(promptErrorSpan); hideError(chatbotErrorSpan); hideError(actionErrorSpan);
            const feedbackSpan = currentStep === 3 ? actionFeedbackSpanStep3 : actionFeedbackSpan;
            if (!feedbackSpan) return;
            feedbackSpan.textContent = message;
            feedbackSpan.classList.add('visible');
            feedbackSpan.style.display = 'block';
            setTimeout(() => {
                 hideFeedback(feedbackSpan);
            }, duration);
        }
        function hideFeedback(feedbackSpan = null) {
            const spansToHide = feedbackSpan ? [feedbackSpan] : [actionFeedbackSpan, actionFeedbackSpanStep3];
            spansToHide.forEach(span => {
                 if (span) {
                     span.classList.remove('visible');
                     setTimeout(() => {
                         if (!span.classList.contains('visible')) {
                             span.textContent = '';
                             span.style.display = 'none';
                         }
                     }, 300);
                 }
            });
        }
        function validateStep1() { hideError(promptErrorSpan); if (!selectedPrompt) { showError(promptErrorSpan, 'Bitte w√§hle zuerst einen Schnellstart-Prompt oder einen Prompt aus der Bibliothek aus.', genericPromptsContainer.querySelector('.generic-prompt-card') || mainCategorySelect); return false; } validatedData.selectedPromptId = selectedPrompt.id; step1Section.classList.add('completed-section'); return true; }
        function validateStep2() { hideError(chatbotErrorSpan); if (!validatedData.selectedChatbot) { showError(chatbotErrorSpan, 'Bitte w√§hle noch einen Chatbot aus.', document.querySelector('.chatbot-option')); return false; } step2Section.classList.add('completed-section'); return true; }
        function validateStep3(isPreview = false) {
            hideError(actionErrorSpan);
            let isValid = true;
            if (!selectedPrompt) { showError(actionErrorSpan, 'Fehler: Kein Prompt ausgew√§hlt. Bitte gehe zur√ºck zu Schritt 1.', step1Section.querySelector('.accordion-header')); isValid = false; }
            if (!validatedData.selectedChatbot) { showError(actionErrorSpan, 'Fehler: Kein Chatbot ausgew√§hlt. Bitte gehe zur√ºck zu Schritt 2.', step2Section.querySelector('.accordion-header')); isValid = false; }
            if (isPreview) {
                const editedPrompt = promptPreviewOutput.value;
                if (!editedPrompt.trim()) {
                     showError(actionErrorSpan, 'Fehler: Der Prompt darf nicht leer sein.', promptPreviewOutput); isValid = false;
                }
            }
            return isValid;
        }
        function generateContextQuestions(contextNeededArray) { if (!contextNeededArray || !Array.isArray(contextNeededArray) || contextNeededArray.length === 0) return ""; let questions = "Bevor du deine Rolle √ºbernimmst, stelle bitte noch folgende R√ºckfragen, um deine Aufgabe bestm√∂glich erf√ºllen zu k√∂nnen:\n"; let questionCount = 0; contextNeededArray.forEach(type => { questionCount++; const lowerType = typeof type === 'string' ? type.toLowerCase() : ''; switch (lowerType) { case 'klasse': questions += `${questionCount}. In welcher **Klasse / Klassenstufe** und Schulart (Gesamtschule, Realschule, Gymnasium, etc.) bist du?\n`; break; case 'fach': questions += `${questionCount}. Um welches **Schulfach** geht es heute?\n`; break; case 'alter': questions += `${questionCount}. Wie **alt** bist du?\n`; break; case 'thema': questions += `${questionCount}. Zu welchem **Thema** m√∂chtest du etwas machen/wissen?\n`; break; case 'gedicht': questions += `${questionCount}. Wie lautet der **Titel/Autor** des Gedichts oder kannst du den **Text** hier einf√ºgen?\n`; break; case 'aktivit√§ten': questions += `${questionCount}. Welche **wichtigen Aufgaben oder Termine** stehen diese Woche an?\n`; break; case 'charakter': questions += `${questionCount}. Welche Art von **Charakter** soll in der Geschichte vorkommen?\n`; break; case 'ziel': questions += `${questionCount}. Was ist dein **Ziel** f√ºr unser Gespr√§ch?\n`; break; case 'rolle': questions += `${questionCount}. Welche **Rolle** soll ich f√ºr dich einnehmen?\n`; break; case 'organisationstyp': questions += `${questionCount}. Um welchen **Organisationstyp** handelt es sich?\n`; break; case 'umfragetyp': questions += `${questionCount}. Um welchen **Typ von Umfrage** handelt es sich?\n`; break; case 'umfragethema': questions += `${questionCount}. Was ist das **Thema der Umfrage**?\n`; break; case 'organisationsziel': questions += `${questionCount}. Was ist das **Ziel der Organisation** im Bezug auf diese Daten?\n`; break; case 'teilnehmer': questions += `${questionCount}. Wer waren die **Teilnehmer*innen** der Umfrage?\n`; break; case 'aufgabenstellung': questions += `${questionCount}. Wie lautet die **Aufgabenstellung** genau (Text oder Datei)?\n`; break; case 'beschreibung der aufgabe': questions += `${questionCount}. Kannst du die **Aufgabe genauer beschreiben**?\n`; break; case 'punkte-skala': questions += `${questionCount}. Welche **Punkte-Skala** soll verwendet werden (z.B. 1-4)?\n`; break; case 'ki-richtlinien': questions += `${questionCount}. Gibt es spezielle **Richtlinien zur KI-Nutzung**?\n`; break; case 'zitationsstil': questions += `${questionCount}. Welcher **Zitationsstil** soll verwendet werden?\n`; break; case 'anzahl aktivit√§ten': questions += `${questionCount}. Wie viele **Aktivit√§ten pro Stufe** sollen erstellt werden?\n`; break; case 'urspr√ºngliche email': questions += `${questionCount}. Wie lautete die **urspr√ºngliche E-Mail**?\n`; break; case 'gew√ºnschte antwort': questions += `${questionCount}. Was ist die **Kernbotschaft deiner Antwort**?\n`; break; case 'gew√ºnschter ton': questions += `${questionCount}. In welchem **Ton** soll die Antwort verfasst sein (z.B. formell, freundlich)?\n`; break; case 'absenderrolle': questions += `${questionCount}. Aus welcher **Rolle** schreibst du (z.B. Lehrkraft, Schulleitung)?\n`; break; case 'ki-generierter text (als datei oder text)': questions += `${questionCount}. Kannst du den **KI-generierten Text** bereitstellen (als Text oder Dateinamen)?\n`; break; case 'thema oder standard': questions += `${questionCount}. Um welches **Thema oder welchen Lernstandard** geht es?\n`; break; case 'zielgruppe': questions += `${questionCount}. Wer ist die **Zielgruppe** der Pr√§sentation?\n`; break; default: questions += `${questionCount}. Kannst du mir mehr √ºber **'${type}'** erz√§hlen?\n`; } }); questions += "\nBitte lass' den Nutzer bzw. die Nutzerin die Fragen nacheinander beantworten und warte auf die Antworten, bevor du loslegst.\n\n---\n\n"; return questions; }
        function generateFinalPromptText(promptObject) { if (!promptObject || !promptObject.promptText) { console.error("generateFinalPromptText: Ung√ºltiges Prompt-Objekt √ºbergeben:", promptObject); if (promptObject && promptObject.title) { return `Fehler: Prompt-Text fehlt f√ºr ‚Äû${promptObject.title}‚Äú. Bitte √ºberpr√ºfe die prompts.json.`; } return "Fehler: Konnte Prompt nicht generieren, da das Prompt-Objekt ung√ºltig ist."; } let basePromptText = ""; if (typeof promptObject.promptText === 'object' && !Array.isArray(promptObject.promptText) && promptObject.promptText !== null) { const keys = Object.keys(promptObject.promptText); if (keys.length > 0) { basePromptText = promptObject.promptText[keys[0]]; } else { console.warn("Prompt-Objekt hat ein leeres 'promptText'-Objekt f√ºr ID:", promptObject.id); basePromptText = ""; } } else if (typeof promptObject.promptText === 'string') { basePromptText = promptObject.promptText; } else { console.error("Unbekanntes Format f√ºr promptText bei ID:", promptObject.id, "Type:", typeof promptObject.promptText); return `Fehler: Prompt-Text f√ºr ‚Äû${promptObject.title || 'Unbekannter Prompt'}‚Äú hat ein ung√ºltiges Format.`; } const contextQuestions = generateContextQuestions(promptObject.contextNeeded); let finalPromptText = basePromptText; if (contextQuestions) { finalPromptText = contextQuestions + basePromptText; } return finalPromptText; }

         function showSelectedPromptPreview() { showSelectedPromptPreviewInternal(); }
         function showSelectedPromptPreviewInternal() {
             const userPromptText = generateFinalPromptText(selectedPrompt); if (userPromptText.startsWith("Fehler:")) { showError(actionErrorSpan, userPromptText, previewEditBtn); resetPreview(); return; }
             promptPreviewOutput.value = botDescription + "\n\n---\n\n" + userPromptText;
             promptPreviewOutput.readOnly = false;
             promptPreviewOutput.style.cursor = 'text';
             promptPreviewOutput.style.backgroundColor = '#fff';
             promptPreviewContainer.style.display = 'block';
             // updateActionButtonState will handle hiding/showing the correct main/preview buttons and notices
             updateActionButtonState();
             if (step3Content.classList.contains('open')) { requestAnimationFrame(() => { if (step3Content && step3Content.scrollHeight) { step3Content.style.maxHeight = step3Content.scrollHeight + "px"; } }); }
             focusOnSection(3);
         }

        async function loadPrompts() {
            try {
                const response = await fetch('prompts.json');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                let loadedData = await response.json();
                if (!Array.isArray(loadedData)) throw new Error("Geladene Daten sind kein Array.");
                allPrompts = loadedData.filter(p => p && p.id && p.title && p.promptText && p.mainCategory);
                if(allPrompts.length === 0) {
                    const errorMsg = loadedData.length > 0 ? "Keine g√ºltigen Prompts nach Filterung gefunden. Pr√ºfe prompts.json Struktur." : "Prompts.json geladen, aber sie ist leer.";
                    console.warn(errorMsg);
                    if (promptListContainer) promptListContainer.innerHTML = `<p role="alert" class="empty-list-message">${errorMsg}</p>`;
                    if (genericPromptsContainer) genericPromptsContainer.innerHTML = `<p role="alert" class="empty-list-message">Keine Schnellstart-Prompts gefunden.</p>`;
                } else {
                    genericPrompts = allPrompts.slice(0, 4); 
                    renderGenericPrompts();
                    populateCategoryFilter();
                    filterAndRenderPrompts();
                }
            } catch (error) {
                console.error("Konnte Prompts nicht laden:", error);
                const errorHTML = `<p role="alert" class="empty-list-message">Fehler beim Laden der Prompts. (${error.message})</p>`;
                if (genericPromptsContainer) genericPromptsContainer.innerHTML = errorHTML;
                if (promptListContainer) promptListContainer.innerHTML = errorHTML;
                if (!step1Content.classList.contains('open')) {
                    step1Section.classList.add('active-section');
                    step1Content.classList.add('open');
                    step1Content.style.maxHeight = '500px'; 
                }
            }
        }
        function populateCategoryFilter() {
            const categories = [...new Set(allPrompts.map(p => p.mainCategory || 'Unbekannt'))]
                .filter(cat => cat !== 'Unbekannt')
                .sort((a, b) => a.localeCompare(b, 'de')); 

            if (mainCategorySelect) {
                mainCategorySelect.querySelectorAll('option:not([value="Alle"])').forEach(opt => opt.remove());
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = `${categoryIcons[category] || categoryIcons['default']} ${category}`; 
                    mainCategorySelect.appendChild(option);
                });
            } else {
                console.error("Kategorie-Select-Element nicht gefunden.");
            }
        }

        function renderGenericPrompts() {
            genericPromptsContainer.innerHTML = '';
            if (genericPrompts.length === 0) {
                genericPromptsContainer.innerHTML = '<p class="empty-list-message">Keine Schnellstart-Prompts verf√ºgbar.</p>';
                return;
            }
            genericPrompts.forEach((prompt, index) => {
                const card = document.createElement('div');
                card.className = 'generic-prompt-card';
                card.dataset.promptId = prompt.id;
                card.setAttribute('role', 'button');
                card.setAttribute('tabindex', '0');
                card.setAttribute('aria-pressed', 'false');
                card.setAttribute('aria-label', prompt.title); 

                const iconNumber = index + 1;
                const iconFilename = `icon${iconNumber}.png`; 

                card.innerHTML = `
                    <div class="prompt-card-icon" aria-hidden="true">
                        <img src="${iconFilename}" alt="Icon f√ºr ${prompt.title}" class="prompt-card-img" onerror="this.style.display='none'"> </div>
                    <h4 class="prompt-card-title">${prompt.title}</h4> <p class="prompt-card-description">${prompt.description || 'Keine Beschreibung verf√ºgbar.'}</p>
                `;
                card.addEventListener('click', () => selectGenericPrompt(prompt.id, card));
                card.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter' || event.key === ' ') {
                        event.preventDefault();
                        selectGenericPrompt(prompt.id, card);
                    }
                });
                if (selectedPrompt && selectedPrompt.id === prompt.id) {
                    card.classList.add('selected');
                    card.setAttribute('aria-pressed', 'true');
                }
                genericPromptsContainer.appendChild(card);
            });
        }

        function selectGenericPrompt(promptId, cardElement) {
            const newlySelectedPrompt = allPrompts.find(p => p.id === promptId);
            if (newlySelectedPrompt) {
                selectedPrompt = newlySelectedPrompt;
                selectedPromptIdInput.value = promptId;
                console.log("Ausgew√§hlter Schnellstart-Prompt:", selectedPrompt.title);
                document.querySelectorAll('.generic-prompt-card').forEach(card => {
                    card.classList.remove('selected');
                    card.setAttribute('aria-pressed', 'false');
                });
                cardElement.classList.add('selected');
                cardElement.setAttribute('aria-pressed', 'true');
                document.querySelectorAll('#prompt-library-list .prompt-item').forEach(item => {
                    item.classList.remove('selected-prompt');
                    item.setAttribute('aria-selected', 'false');
                });
                hideError(promptErrorSpan); hideFeedback();
                resetPreview(); 
                if (validateStep1()) {
                    if (validatedData.selectedChatbot) { updateAccordionState(3); }
                    else { updateAccordionState(2); }
                } else { updateActionButtonState(); } 
            } else {
                console.error("Ausgew√§hlter Schnellstart-Prompt mit ID nicht gefunden:", promptId);
                showError(promptErrorSpan, 'Fehler: Konnte ausgew√§hlten Schnellstart-Prompt nicht finden.');
            }
        }
        function filterAndRenderPrompts() {
            const searchTerm = promptSearchInput.value.toLowerCase().trim();
            selectedMainCategory = mainCategorySelect ? mainCategorySelect.value : 'Alle';
            filteredPrompts = allPrompts.filter(prompt => {
                const mainCategoryMatch = selectedMainCategory === 'Alle' || (prompt.mainCategory === selectedMainCategory);
                const searchMatch = !searchTerm ||
                                    (prompt.title && prompt.title.toLowerCase().includes(searchTerm)) ||
                                    (prompt.description && prompt.description.toLowerCase().includes(searchTerm)) ||
                                    (Array.isArray(prompt.tags) && prompt.tags.some(tag => tag.toLowerCase().includes(searchTerm)));
                return mainCategoryMatch && searchMatch;
            });
            const genericPromptIds = genericPrompts.map(p => p.id);
            filteredPrompts = filteredPrompts.filter(prompt => !genericPromptIds.includes(prompt.id));
            const isLibraryPromptSelected = selectedPrompt && !genericPrompts.some(gp => gp.id === selectedPrompt.id);
            if (isLibraryPromptSelected && !filteredPrompts.some(p => p.id === selectedPrompt.id)) {
                const selectedItem = promptListContainer.querySelector('.selected-prompt');
                if (selectedItem) {
                    selectedItem.classList.remove('selected-prompt');
                    selectedItem.setAttribute('aria-selected', 'false');
                }
            }
            renderPromptList(); 
            if (step1Content.classList.contains('open')) {
                requestAnimationFrame(() => {
                    if (step1Content && step1Content.scrollHeight) {
                        step1Content.style.maxHeight = step1Content.scrollHeight + "px";
                    }
                });
            }
        }
        function renderPromptList() {
            promptListContainer.innerHTML = ''; 
            if (filteredPrompts.length === 0) {
                promptListContainer.innerHTML = '<p class="empty-list-message">Keine Prompts f√ºr diese Filter gefunden.<br>Versuche, die Filter anzupassen oder w√§hle einen Schnellstart-Prompt.</p>';
            } else {
                 filteredPrompts.forEach(prompt => {
                    const promptElement = document.createElement('div');
                    promptElement.className = 'prompt-item';
                    promptElement.setAttribute('role', 'option'); 
                    promptElement.setAttribute('tabindex', '0'); 
                    promptElement.dataset.promptId = prompt.id;
                    promptElement.setAttribute('aria-selected', 'false'); 

                    let detailsHtml = '<div class="details">';
                    if (prompt.mainCategory) detailsHtml += `<span class="badge category-badge">${prompt.mainCategory}</span>`;
                    detailsHtml += '</div>';

                    let displayTitle = prompt.title || 'Unbenannter Prompt';
                    let displayDescription = prompt.description || 'Keine Beschreibung.';

                    if (typeof prompt.promptText === 'object' && !Array.isArray(prompt.promptText) && prompt.promptText !== null) {
                        if (Object.keys(prompt.promptText).length > 1) { displayTitle += " (Varianten)"; }
                        else if (Object.keys(prompt.promptText).length === 0) { displayTitle += " (Text fehlt!)"; }
                    }

                    const icon = categoryIcons[prompt.mainCategory] || categoryIcons['default'];
                    const titleHtml = `<div class="prompt-title-container"><span class="prompt-title-icon" aria-hidden="true">${icon}</span><strong>${displayTitle}</strong></div>`;

                    promptElement.innerHTML = `
                        ${titleHtml}
                        <p class="description">${displayDescription}</p>
                        ${detailsHtml}
                    `;

                    promptElement.addEventListener('click', () => selectPrompt(prompt.id, promptElement));
                    promptElement.addEventListener('keydown', (event) => {
                        if (event.key === 'Enter' || event.key === ' ') {
                            event.preventDefault();
                            selectPrompt(prompt.id, promptElement);
                        }
                    });

                    if (selectedPrompt && selectedPrompt.id === prompt.id && !genericPrompts.some(gp => gp.id === prompt.id)) {
                        promptElement.classList.add('selected-prompt');
                        promptElement.setAttribute('aria-selected', 'true');
                    }

                    promptListContainer.appendChild(promptElement);
                });
            }
        }
        function selectPrompt(promptId, element) {
            const newlySelectedPrompt = allPrompts.find(p => p.id === promptId);
            if (newlySelectedPrompt) {
                selectedPrompt = newlySelectedPrompt;
                selectedPromptIdInput.value = promptId;
                console.log("Ausgew√§hlter Bibliotheks-Prompt:", selectedPrompt.title);
                document.querySelectorAll('.generic-prompt-card').forEach(card => {
                    card.classList.remove('selected');
                    card.setAttribute('aria-pressed', 'false');
                });
                document.querySelectorAll('#prompt-library-list .prompt-item').forEach(item => {
                    item.classList.remove('selected-prompt');
                    item.setAttribute('aria-selected', 'false');
                });
                if(element) { 
                    element.classList.add('selected-prompt');
                    element.setAttribute('aria-selected', 'true');
                } else {
                    renderPromptList();
                }
                hideError(promptErrorSpan); hideFeedback();
                resetPreview(); 
                if (validateStep1()) {
                    if (validatedData.selectedChatbot) { updateAccordionState(3); }
                    else { updateAccordionState(2); }
                } else { updateActionButtonState(); } 
            } else {
                console.error("Ausgew√§hlter Prompt mit ID nicht gefunden:", promptId);
                showError(promptErrorSpan, 'Fehler: Konnte ausgew√§hlten Prompt nicht finden.');
            }
        }

        function setupActionAnchorListener(anchorElement, isPreview) {
             if (anchorElement) {
                anchorElement.addEventListener('click', function(event) {
                    if (anchorElement.classList.contains('disabled')) {
                        event.preventDefault(); 
                        return;
                    }

                    if (!validateStep1() || !validateStep2() || !validateStep3(isPreview)) {
                        event.preventDefault(); 
                        return;
                    }

                    let userPromptText;
                    let includeSystemPrompt = true;
                    if (isPreview) {
                        userPromptText = promptPreviewOutput.value;
                        includeSystemPrompt = false; 
                        if (!userPromptText.trim()) {
                            event.preventDefault();
                            showError(actionErrorSpan, 'Fehler: Der Prompt darf nicht leer sein.', promptPreviewOutput);
                            return;
                        }
                    } else {
                        userPromptText = generateFinalPromptText(selectedPrompt);
                        if (userPromptText.startsWith("Fehler:")) {
                            event.preventDefault();
                            showError(actionErrorSpan, userPromptText, anchorElement);
                            return;
                        }
                         includeSystemPrompt = true;
                    }

                    const finalPromptWithSystemInstructions = includeSystemPrompt ? (botDescription + "\n\n---\n\n" + userPromptText) : userPromptText;

                    if (!finalPromptWithSystemInstructions.trim()) {
                         event.preventDefault();
                         showError(actionErrorSpan, 'Fehler: Der finale Prompt darf nicht leer sein.');
                         return;
                    }

                    const chatbot = validatedData.selectedChatbot;
                    let targetUrl = '';

                    switch (chatbot) {
                        case 'chatgpt':
                            targetUrl = `https://chatgpt.com/?q=${encodeURIComponent(finalPromptWithSystemInstructions)}`;
                            break;
                        case 'claude':
                            targetUrl = `https://claude.ai/new?q=${encodeURIComponent(finalPromptWithSystemInstructions)}`;
                            break;
                        case 'mistral':
                            targetUrl = `https://chat.mistral.ai/chat?q=${encodeURIComponent(finalPromptWithSystemInstructions)}`;
                            break;
                        case 'copilot':
                            targetUrl = `https://copilot.microsoft.com/?q=${encodeURIComponent(finalPromptWithSystemInstructions)}`;
                            break;
                        case 'gemini':
                            targetUrl = 'https://gemini.google.com/'; // Base URL
                            break;
                        case 'duckai':
                            targetUrl = 'https://duckduckgo.com/?q=DuckDuckGo+AI+Chat&ia=chat&duckai=1'; // Base URL
                            break;
                        default:
                            console.error("Unbekannter Chatbot:", chatbot);
                            showError(actionErrorSpan, 'Fehler: Chatbot konnte nicht gestartet werden.');
                            event.preventDefault();
                            return;
                    }

                    anchorElement.href = targetUrl; 
                    anchorElement.target = '_blank';

                    if (chatbot === 'gemini' || chatbot === 'duckai') {
                        event.preventDefault(); 

                        if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
                            navigator.clipboard.writeText(finalPromptWithSystemInstructions).then(() => {
                                showFeedback("Prompt kopiert! Bitte im Chatbot einf√ºgen. Weiterleitung zum Buch...", 3500);
                                anchorElement.classList.add('success-feedback');
                                setTimeout(() => { anchorElement.classList.remove('success-feedback'); }, 550);

                                window.open(targetUrl, '_blank'); 

                                setTimeout(() => {
                                    window.location.href = bookUrl;
                                }, 200); 

                            }).catch(err => {
                                console.error('Fehler beim Kopieren:', err);
                                showError(actionErrorSpan, 'Fehler: Prompt nicht kopiert. √ñffne Chatbot & kopiere manuell.');
                                window.open(targetUrl, '_blank');
                                setTimeout(() => {
                                    window.location.href = bookUrl; 
                                }, 200);
                            });
                        } else {
                             showError(actionErrorSpan, 'Zwischenablage nicht verf√ºgbar. √ñffne Chatbot & kopiere manuell.');
                             window.open(targetUrl, '_blank');
                             setTimeout(() => {
                                 window.location.href = bookUrl;
                             }, 200);
                        }
                    } else { // For other chatbots, let the default action of the anchor open it
                        showFeedback("Chatbot wird ge√∂ffnet & Weiterleitung zum Buch...", 1500);
                        anchorElement.classList.add('success-feedback');
                        setTimeout(() => { anchorElement.classList.remove('success-feedback'); }, 550);
                        setTimeout(() => {
                            window.location.href = bookUrl;
                        }, 150);
                        // DO NOT preventDefault() here for these other chatbots
                    }
                });
             }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadPrompts().then(() => {
                if (step1Content.classList.contains('open')) {
                    requestAnimationFrame(() => {
                        if (step1Content && step1Content.scrollHeight) {
                            step1Content.style.maxHeight = step1Content.scrollHeight + "px";
                        }
                    });
                }
                updateActionButtonState(); 
            });

            promptPreviewOutput.readOnly = true;
            promptPreviewOutput.style.cursor = 'not-allowed';
            promptPreviewOutput.style.backgroundColor = '#e9ecef';

            if (mainCategorySelect) { mainCategorySelect.addEventListener('change', filterAndRenderPrompts); }
            if(promptSearchInput) { promptSearchInput.addEventListener('input', filterAndRenderPrompts); }

            setupActionAnchorListener(startChatAnchor, false); 
            setupActionAnchorListener(launchChatbotAnchor, true); 

            requestAnimationFrame(() => {
                if(step1Content.classList.contains('open') && step1Content.scrollHeight) {
                    step1Content.style.maxHeight = step1Content.scrollHeight + "px";
                }
            });
            updateActionButtonState(); 
        });
    </script>
</body>

</html>
